/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const t=window.ShadowRoot&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,e=Symbol();class i{constructor(t,i){if(i!==e)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t}get styleSheet(){return t&&void 0===this.t&&(this.t=new CSSStyleSheet,this.t.replaceSync(this.cssText)),this.t}toString(){return this.cssText}}const s=new Map,o=t=>{let o=s.get(t);return void 0===o&&s.set(t,o=new i(t,e)),o},n=(t,...e)=>{const s=1===t.length?t[0]:e.reduce(((e,s,o)=>e+(t=>{if(t instanceof i)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(s)+t[o+1]),t[0]);return o(s)},a=t?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return(t=>o("string"==typeof t?t:t+""))(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var r,l,h,c;const d={toAttribute(t,e){switch(e){case Boolean:t=t?"":null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},p=(t,e)=>e!==t&&(e==e||t==t),u={attribute:!0,type:String,converter:d,reflect:!1,hasChanged:p};class m extends HTMLElement{constructor(){super(),this.Πi=new Map,this.Πo=void 0,this.Πl=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this.Πh=null,this.u()}static addInitializer(t){var e;null!==(e=this.v)&&void 0!==e||(this.v=[]),this.v.push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach(((e,i)=>{const s=this.Πp(i,e);void 0!==s&&(this.Πm.set(s,i),t.push(s))})),t}static createProperty(t,e=u){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const i="symbol"==typeof t?Symbol():"__"+t,s=this.getPropertyDescriptor(t,i,e);void 0!==s&&Object.defineProperty(this.prototype,t,s)}}static getPropertyDescriptor(t,e,i){return{get(){return this[e]},set(s){const o=this[t];this[e]=s,this.requestUpdate(t,o,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||u}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),this.elementProperties=new Map(t.elementProperties),this.Πm=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const i of e)this.createProperty(i,t[i])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(a(t))}else void 0!==t&&e.push(a(t));return e}static Πp(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}u(){var t;this.Πg=new Promise((t=>this.enableUpdating=t)),this.L=new Map,this.Π_(),this.requestUpdate(),null===(t=this.constructor.v)||void 0===t||t.forEach((t=>t(this)))}addController(t){var e,i;(null!==(e=this.ΠU)&&void 0!==e?e:this.ΠU=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(i=t.hostConnected)||void 0===i||i.call(t))}removeController(t){var e;null===(e=this.ΠU)||void 0===e||e.splice(this.ΠU.indexOf(t)>>>0,1)}Π_(){this.constructor.elementProperties.forEach(((t,e)=>{this.hasOwnProperty(e)&&(this.Πi.set(e,this[e]),delete this[e])}))}createRenderRoot(){var e;const i=null!==(e=this.shadowRoot)&&void 0!==e?e:this.attachShadow(this.constructor.shadowRootOptions);return((e,i)=>{t?e.adoptedStyleSheets=i.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet)):i.forEach((t=>{const i=document.createElement("style");i.textContent=t.cssText,e.appendChild(i)}))})(i,this.constructor.elementStyles),i}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this.ΠU)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)})),this.Πl&&(this.Πl(),this.Πo=this.Πl=void 0)}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this.ΠU)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)})),this.Πo=new Promise((t=>this.Πl=t))}attributeChangedCallback(t,e,i){this.K(t,i)}Πj(t,e,i=u){var s,o;const n=this.constructor.Πp(t,i);if(void 0!==n&&!0===i.reflect){const a=(null!==(o=null===(s=i.converter)||void 0===s?void 0:s.toAttribute)&&void 0!==o?o:d.toAttribute)(e,i.type);this.Πh=t,null==a?this.removeAttribute(n):this.setAttribute(n,a),this.Πh=null}}K(t,e){var i,s,o;const n=this.constructor,a=n.Πm.get(t);if(void 0!==a&&this.Πh!==a){const t=n.getPropertyOptions(a),r=t.converter,l=null!==(o=null!==(s=null===(i=r)||void 0===i?void 0:i.fromAttribute)&&void 0!==s?s:"function"==typeof r?r:null)&&void 0!==o?o:d.fromAttribute;this.Πh=a,this[a]=l(e,t.type),this.Πh=null}}requestUpdate(t,e,i){let s=!0;void 0!==t&&(((i=i||this.constructor.getPropertyOptions(t)).hasChanged||p)(this[t],e)?(this.L.has(t)||this.L.set(t,e),!0===i.reflect&&this.Πh!==t&&(void 0===this.Πk&&(this.Πk=new Map),this.Πk.set(t,i))):s=!1),!this.isUpdatePending&&s&&(this.Πg=this.Πq())}async Πq(){this.isUpdatePending=!0;try{for(await this.Πg;this.Πo;)await this.Πo}catch(t){Promise.reject(t)}const t=this.performUpdate();return null!=t&&await t,!this.isUpdatePending}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this.Πi&&(this.Πi.forEach(((t,e)=>this[e]=t)),this.Πi=void 0);let e=!1;const i=this.L;try{e=this.shouldUpdate(i),e?(this.willUpdate(i),null===(t=this.ΠU)||void 0===t||t.forEach((t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)})),this.update(i)):this.Π$()}catch(t){throw e=!1,this.Π$(),t}e&&this.E(i)}willUpdate(t){}E(t){var e;null===(e=this.ΠU)||void 0===e||e.forEach((t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}Π$(){this.L=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this.Πg}shouldUpdate(t){return!0}update(t){void 0!==this.Πk&&(this.Πk.forEach(((t,e)=>this.Πj(e,this[e],t))),this.Πk=void 0),this.Π$()}updated(t){}firstUpdated(t){}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var b,g,x,f;m.finalized=!0,m.elementProperties=new Map,m.elementStyles=[],m.shadowRootOptions={mode:"open"},null===(l=(r=globalThis).reactiveElementPlatformSupport)||void 0===l||l.call(r,{ReactiveElement:m}),(null!==(h=(c=globalThis).reactiveElementVersions)&&void 0!==h?h:c.reactiveElementVersions=[]).push("1.0.0-rc.2");const y=globalThis.trustedTypes,v=y?y.createPolicy("lit-html",{createHTML:t=>t}):void 0,S=`lit$${(Math.random()+"").slice(9)}$`,w="?"+S,_=`<${w}>`,E=document,A=(t="")=>E.createComment(t),O=t=>null===t||"object"!=typeof t&&"function"!=typeof t,k=Array.isArray,T=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,C=/-->/g,$=/>/g,D=/>|[ 	\n\r](?:([^\s"'>=/]+)([ 	\n\r]*=[ 	\n\r]*(?:[^ 	\n\r"'`<>=]|("|')|))|$)/g,B=/'/g,I=/"/g,N=/^(?:script|style|textarea)$/i,L=(t=>(e,...i)=>({_$litType$:t,strings:e,values:i}))(1),F=Symbol.for("lit-noChange"),R=Symbol.for("lit-nothing"),z=new WeakMap,M=E.createTreeWalker(E,129,null,!1),P=(t,e)=>{const i=t.length-1,s=[];let o,n=2===e?"<svg>":"",a=T;for(let e=0;e<i;e++){const i=t[e];let r,l,h=-1,c=0;for(;c<i.length&&(a.lastIndex=c,l=a.exec(i),null!==l);)c=a.lastIndex,a===T?"!--"===l[1]?a=C:void 0!==l[1]?a=$:void 0!==l[2]?(N.test(l[2])&&(o=RegExp("</"+l[2],"g")),a=D):void 0!==l[3]&&(a=D):a===D?">"===l[0]?(a=null!=o?o:T,h=-1):void 0===l[1]?h=-2:(h=a.lastIndex-l[2].length,r=l[1],a=void 0===l[3]?D:'"'===l[3]?I:B):a===I||a===B?a=D:a===C||a===$?a=T:(a=D,o=void 0);const d=a===D&&t[e+1].startsWith("/>")?" ":"";n+=a===T?i+_:h>=0?(s.push(r),i.slice(0,h)+"$lit$"+i.slice(h)+S+d):i+S+(-2===h?(s.push(void 0),e):d)}const r=n+(t[i]||"<?>")+(2===e?"</svg>":"");return[void 0!==v?v.createHTML(r):r,s]};class j{constructor({strings:t,_$litType$:e},i){let s;this.parts=[];let o=0,n=0;const a=t.length-1,r=this.parts,[l,h]=P(t,e);if(this.el=j.createElement(l,i),M.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(s=M.nextNode())&&r.length<a;){if(1===s.nodeType){if(s.hasAttributes()){const t=[];for(const e of s.getAttributeNames())if(e.endsWith("$lit$")||e.startsWith(S)){const i=h[n++];if(t.push(e),void 0!==i){const t=s.getAttribute(i.toLowerCase()+"$lit$").split(S),e=/([.?@])?(.*)/.exec(i);r.push({type:1,index:o,name:e[2],strings:t,ctor:"."===e[1]?W:"?"===e[1]?q:"@"===e[1]?X:U})}else r.push({type:6,index:o})}for(const e of t)s.removeAttribute(e)}if(N.test(s.tagName)){const t=s.textContent.split(S),e=t.length-1;if(e>0){s.textContent=y?y.emptyScript:"";for(let i=0;i<e;i++)s.append(t[i],A()),M.nextNode(),r.push({type:2,index:++o});s.append(t[e],A())}}}else if(8===s.nodeType)if(s.data===w)r.push({type:2,index:o});else{let t=-1;for(;-1!==(t=s.data.indexOf(S,t+1));)r.push({type:7,index:o}),t+=S.length-1}o++}}static createElement(t,e){const i=E.createElement("template");return i.innerHTML=t,i}}function G(t,e,i=t,s){var o,n,a,r;if(e===F)return e;let l=void 0!==s?null===(o=i.Σi)||void 0===o?void 0:o[s]:i.Σo;const h=O(e)?void 0:e._$litDirective$;return(null==l?void 0:l.constructor)!==h&&(null===(n=null==l?void 0:l.O)||void 0===n||n.call(l,!1),void 0===h?l=void 0:(l=new h(t),l.T(t,i,s)),void 0!==s?(null!==(a=(r=i).Σi)&&void 0!==a?a:r.Σi=[])[s]=l:i.Σo=l),void 0!==l&&(e=G(t,l.S(t,e.values),l,s)),e}class H{constructor(t,e){this.l=[],this.N=void 0,this.D=t,this.M=e}u(t){var e;const{el:{content:i},parts:s}=this.D,o=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:E).importNode(i,!0);M.currentNode=o;let n=M.nextNode(),a=0,r=0,l=s[0];for(;void 0!==l;){if(a===l.index){let e;2===l.type?e=new V(n,n.nextSibling,this,t):1===l.type?e=new l.ctor(n,l.name,l.strings,this,t):6===l.type&&(e=new Z(n,this,t)),this.l.push(e),l=s[++r]}a!==(null==l?void 0:l.index)&&(n=M.nextNode(),a++)}return o}v(t){let e=0;for(const i of this.l)void 0!==i&&(void 0!==i.strings?(i.I(t,i,e),e+=i.strings.length-2):i.I(t[e])),e++}}class V{constructor(t,e,i,s){this.type=2,this.N=void 0,this.A=t,this.B=e,this.M=i,this.options=s}setConnected(t){var e;null===(e=this.P)||void 0===e||e.call(this,t)}get parentNode(){return this.A.parentNode}get startNode(){return this.A}get endNode(){return this.B}I(t,e=this){t=G(this,t,e),O(t)?t===R||null==t||""===t?(this.H!==R&&this.R(),this.H=R):t!==this.H&&t!==F&&this.m(t):void 0!==t._$litType$?this._(t):void 0!==t.nodeType?this.$(t):(t=>{var e;return k(t)||"function"==typeof(null===(e=t)||void 0===e?void 0:e[Symbol.iterator])})(t)?this.g(t):this.m(t)}k(t,e=this.B){return this.A.parentNode.insertBefore(t,e)}$(t){this.H!==t&&(this.R(),this.H=this.k(t))}m(t){const e=this.A.nextSibling;null!==e&&3===e.nodeType&&(null===this.B?null===e.nextSibling:e===this.B.previousSibling)?e.data=t:this.$(E.createTextNode(t)),this.H=t}_(t){var e;const{values:i,_$litType$:s}=t,o="number"==typeof s?this.C(t):(void 0===s.el&&(s.el=j.createElement(s.h,this.options)),s);if((null===(e=this.H)||void 0===e?void 0:e.D)===o)this.H.v(i);else{const t=new H(o,this),e=t.u(this.options);t.v(i),this.$(e),this.H=t}}C(t){let e=z.get(t.strings);return void 0===e&&z.set(t.strings,e=new j(t)),e}g(t){k(this.H)||(this.H=[],this.R());const e=this.H;let i,s=0;for(const o of t)s===e.length?e.push(i=new V(this.k(A()),this.k(A()),this,this.options)):i=e[s],i.I(o),s++;s<e.length&&(this.R(i&&i.B.nextSibling,s),e.length=s)}R(t=this.A.nextSibling,e){var i;for(null===(i=this.P)||void 0===i||i.call(this,!1,!0,e);t&&t!==this.B;){const e=t.nextSibling;t.remove(),t=e}}}class U{constructor(t,e,i,s,o){this.type=1,this.H=R,this.N=void 0,this.V=void 0,this.element=t,this.name=e,this.M=s,this.options=o,i.length>2||""!==i[0]||""!==i[1]?(this.H=Array(i.length-1).fill(R),this.strings=i):this.H=R}get tagName(){return this.element.tagName}I(t,e=this,i,s){const o=this.strings;let n=!1;if(void 0===o)t=G(this,t,e,0),n=!O(t)||t!==this.H&&t!==F,n&&(this.H=t);else{const s=t;let a,r;for(t=o[0],a=0;a<o.length-1;a++)r=G(this,s[i+a],e,a),r===F&&(r=this.H[a]),n||(n=!O(r)||r!==this.H[a]),r===R?t=R:t!==R&&(t+=(null!=r?r:"")+o[a+1]),this.H[a]=r}n&&!s&&this.W(t)}W(t){t===R?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class W extends U{constructor(){super(...arguments),this.type=3}W(t){this.element[this.name]=t===R?void 0:t}}class q extends U{constructor(){super(...arguments),this.type=4}W(t){t&&t!==R?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name)}}class X extends U{constructor(){super(...arguments),this.type=5}I(t,e=this){var i;if((t=null!==(i=G(this,t,e,0))&&void 0!==i?i:R)===F)return;const s=this.H,o=t===R&&s!==R||t.capture!==s.capture||t.once!==s.once||t.passive!==s.passive,n=t!==R&&(s===R||o);o&&this.element.removeEventListener(this.name,this,s),n&&this.element.addEventListener(this.name,this,t),this.H=t}handleEvent(t){var e,i;"function"==typeof this.H?this.H.call(null!==(i=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==i?i:this.element,t):this.H.handleEvent(t)}}class Z{constructor(t,e,i){this.element=t,this.type=6,this.N=void 0,this.V=void 0,this.M=e,this.options=i}I(t){G(this,t)}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var J,Y,K,Q,tt,et;null===(g=(b=globalThis).litHtmlPlatformSupport)||void 0===g||g.call(b,j,V),(null!==(x=(f=globalThis).litHtmlVersions)&&void 0!==x?x:f.litHtmlVersions=[]).push("2.0.0-rc.3"),(null!==(J=(et=globalThis).litElementVersions)&&void 0!==J?J:et.litElementVersions=[]).push("3.0.0-rc.2");class it extends m{constructor(){super(...arguments),this.renderOptions={host:this},this.Φt=void 0}createRenderRoot(){var t,e;const i=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=i.firstChild),i}update(t){const e=this.render();super.update(t),this.Φt=((t,e,i)=>{var s,o;const n=null!==(s=null==i?void 0:i.renderBefore)&&void 0!==s?s:e;let a=n._$litPart$;if(void 0===a){const t=null!==(o=null==i?void 0:i.renderBefore)&&void 0!==o?o:null;n._$litPart$=a=new V(e.insertBefore(A(),t),t,void 0,i)}return a.I(t),a})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this.Φt)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this.Φt)||void 0===t||t.setConnected(!1)}render(){return F}}it.finalized=!0,it._$litElement$=!0,null===(K=(Y=globalThis).litElementHydrateSupport)||void 0===K||K.call(Y,{LitElement:it}),null===(tt=(Q=globalThis).litElementPlatformSupport)||void 0===tt||tt.call(Q,{LitElement:it});const st=t=>class extends t{static get properties(){return{sidebarVisible:{type:Boolean}}}static styles=n`:host{--sidebar-width-expanded:300px;--sidebar-width-hidden:15px;display:flex;align-items:stretch;height:100%}div{width:calc(100% - var(--sidebar-width-expanded));height:100%}div[expanded]{width:calc(100% - var(--sidebar-width-hidden))}`;constructor(t,e){super(),this.sidebarVisible=!0,this.sidebarEl=e,this.webpartEl=t}_connectWebpartEl(){this.getWebpartEl()&&this.getWebpartEl().addEventListener("ready",this.handleWebpartChange.bind(this))}_connectSidebarEl(){this.getSidebarEl()&&this.getSidebarEl().addEventListener("change",this.handleSidebarChange.bind(this))}_disconnectWebpartEl(){this.getWebpartEl()&&this.getWebpartEl().removeEventListener("ready",this.handleWebpartChange.bind(this))}_disconnectSidebarEl(){this.getSidebarEl()&&this.getSidebarEl().removeEventListener("change",this.handleSidebarChange.bind(this))}connectedCallback(){super.connectedCallback(),this._connectWebpartEl(),this._connectSidebarEl()}disconnectedCallback(){this._disconnectWebpartEl(),this._disconnectSidebarEl(),super.disconnectedCallback()}setWebpartEl(t){this.webpartEl=t,this._connectWebpartEl()}setSidebarEl(t){this.sidebarEl=t,this._connectSidebarEl()}getWebpartEl(){return this.webpartEl}getSidebarEl(){return this.sidebarEl}renderWebpartEl(){return this.getWebpartEl()}renderSidebarEl(){return this.getSidebarEl()}renderWebPart(){return L`<div ?expanded="${!this.sidebarVisible}">${this.renderWebpartEl()}</div>${this.renderSidebarEl()}`}async handleWebpartChange(t){this.sidebarEl&&(console.log("REQUESTING UPDATE FROM WEBVIEWER"),this.sidebarEl.requestUpdate())}async handleSidebarChange(t){console.log("SIDEBAR CHANGE",t),this.sidebarVisible=t.detail.visible,this.requestUpdate(),await this.updateComplete,console.log("DISPATCH EVENT"),window.dispatchEvent(new Event("resize"))}};var ot=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some((function(t,s){return t[0]===e&&(i=s,!0)})),i}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),s=this.__entries__[i];return s&&s[1]},e.prototype.set=function(e,i){var s=t(this.__entries__,e);~s?this.__entries__[s][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,s=t(i,e);~s&&i.splice(s,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,s=this.__entries__;i<s.length;i++){var o=s[i];t.call(e,o[1],o[0])}},e}()}(),nt="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,at="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),rt="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(at):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var lt=["top","right","bottom","left","width","height","size","weight"],ht="undefined"!=typeof MutationObserver,ct=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,s=!1,o=0;function n(){i&&(i=!1,t()),s&&r()}function a(){rt(n)}function r(){var t=Date.now();if(i){if(t-o<2)return;s=!0}else i=!0,s=!1,setTimeout(a,e);o=t}return r}(this.refresh.bind(this),20)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){nt&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),ht?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){nt&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e;lt.some((function(t){return!!~i.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),dt=function(t,e){for(var i=0,s=Object.keys(e);i<s.length;i++){var o=s[i];Object.defineProperty(t,o,{value:e[o],enumerable:!1,writable:!1,configurable:!0})}return t},pt=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||at},ut=yt(0,0,0,0);function mt(t){return parseFloat(t)||0}function bt(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce((function(e,i){return e+mt(t["border-"+i+"-width"])}),0)}function gt(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return ut;var s=pt(t).getComputedStyle(t),o=function(t){for(var e={},i=0,s=["top","right","bottom","left"];i<s.length;i++){var o=s[i],n=t["padding-"+o];e[o]=mt(n)}return e}(s),n=o.left+o.right,a=o.top+o.bottom,r=mt(s.width),l=mt(s.height);if("border-box"===s.boxSizing&&(Math.round(r+n)!==e&&(r-=bt(s,"left","right")+n),Math.round(l+a)!==i&&(l-=bt(s,"top","bottom")+a)),!function(t){return t===pt(t).document.documentElement}(t)){var h=Math.round(r+n)-e,c=Math.round(l+a)-i;1!==Math.abs(h)&&(r-=h),1!==Math.abs(c)&&(l-=c)}return yt(o.left,o.top,r,l)}var xt="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof pt(t).SVGGraphicsElement}:function(t){return t instanceof pt(t).SVGElement&&"function"==typeof t.getBBox};function ft(t){return nt?xt(t)?function(t){var e=t.getBBox();return yt(0,0,e.width,e.height)}(t):gt(t):ut}function yt(t,e,i,s){return{x:t,y:e,width:i,height:s}}var vt=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=yt(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=ft(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),St=function(t,e){var i=function(t){var e=t.x,i=t.y,s=t.width,o=t.height,n="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,a=Object.create(n.prototype);return dt(a,{x:e,y:i,width:s,height:o,top:i,right:e+s,bottom:o+i,left:e}),a}(e);dt(this,{target:t,contentRect:i})},wt=function(){function t(t,e,i){if(this.activeObservations_=[],this.observations_=new ot,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=i}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof pt(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new vt(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof pt(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new St(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),_t="undefined"!=typeof WeakMap?new WeakMap:new ot,Et=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=ct.getInstance(),s=new wt(e,i,this);_t.set(this,s)};["observe","unobserve","disconnect"].forEach((function(t){Et.prototype[t]=function(){var e;return(e=_t.get(this))[t].apply(e,arguments)}}));var At=void 0!==at.ResizeObserver?at.ResizeObserver:Et;function Ot(t,e=!1){let i=t.getZr().painter.getSvgDom().cloneNode(!0),s=/rgba\((.*),([0-9]+)\)/,o=["fill","stroke"];if(i.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),i.querySelectorAll("*").forEach((function(t){t.hasAttribute("stroke-dasharray")&&""==t.getAttribute("stroke-dasharray")&&t.removeAttribute("stroke-dasharray"),"text"==t.nodeName&&t.hasAttribute("stroke")&&t.removeAttribute("stroke"),o.map((e=>{if(t.hasAttribute(e)){let i=t.getAttribute(e).match(s);null!=i&&(t.setAttribute(e,`rgb(${i[1]})`),t.setAttribute(`${e}-opacity`,i[2]))}})),"undefined"==t.getAttribute("fill-opacity")&&t.removeAttribute("fill-opacity")})),e){const t=i.querySelectorAll("text"),e=parseFloat(i.getAttribute("height"));t.forEach((t=>{let i=t.getAttribute("transform"),s=/matrix\(.*,([\-0-9\.]+),([\-0-9\.]+)\)/gm.exec(i);if(null!=s){if(parseFloat(s[2])>e-25){let e=t.children[0]||t,i=parseInt(e.getAttribute("y"));parseInt(e.getAttribute("x")),e.setAttribute("y",i+4)}}}))}return i.outerHTML}var kt=function(t=null){return t||(t="'Roboto'"),{nameTextStyle:{fontFamily:t,fontWeight:"normal",fontStyle:"normal",fontSize:14,color:"#000",width:null,overflow:"break"},axisLabel:{fontFamily:t,fontWeight:"normal",fontStyle:"normal",fontSize:12,formatter:"{value}",color:"#000",margin:8},axisLine:{show:!0,onZero:!1,lineStyle:{color:"#000"}},splitLine:{lineStyle:{color:"#C0C0C0"}},splitArea:{areaStyle:{color:["rgba(255,255,255,0.02)","rgba(255,255,255,0.05)"]}},minorSplitLine:{lineStyle:{color:"#C0C0C0"}},offset:10}},Tt=["rgba(185,205,240,1)","rgba(251,114,108,1)","rgba(175,225,190,1)","rgba(215,175,220,1)","rgba(242,133,0,1)","rgba(249,235,200,1)","rgba(235,200,225,1)","rgba(211,221,240,1)","rgba(251,140,135,1)","rgba(199,225,207,1)","rgba(218,199,220,1)","rgba(242,145,26,1)","rgba(249,243,227,1)","rgba(235,225,232,1)","rgba(237,238,240,1)","rgba(251,166,162,1)","rgba(223,225,224,1)","rgba(196,2,220,1)","rgba(242,156,52,1)","rgba(249,179,5,1)","rgba(235,16,172,1)","rgba(23,102,240,1)","rgba(251,192,189,1)","rgba(23,225,83,1)","rgba(198,26,220,1)","rgba(242,168,78,1)","rgba(249,187,31,1)","rgba(235,41,180,1)","rgba(48,118,240,1)","rgba(251,218,216,1)"],Ct=function(t=null){t||(t="'Roboto'");let e={animation:!1,color:Tt,backgroundColor:"#FFF",axisPointer:{lineStyle:{color:"#817f91"},crossStyle:{color:"#817f91"},label:{color:"#fff"}},legend:{textStyle:{color:"#000",fontFamily:t}},grid:{containLabel:!0},textStyle:{color:"#000"},title:{textStyle:{color:"#000000",fontFamily:t,fontWeight:"bold",fontStyle:"normal",fontSize:20,width:null,overflow:"break"},subtextStyle:{color:"#808080",fontFamily:t,fontStyle:"normal",fontWeight:"normal",fontSize:12,width:null,overflow:"break"}},toolbox:{iconStyle:{borderColor:"#000"}},tooltip:{show:!0,padding:5,borderWidth:1,backgroundColor:"#fafafa",borderColor:"rgb(85,85,85)",transitionDuration:0,extraCssText:"border-radius: 0px;",textStyle:{color:"#333"}},dataZoom:{borderColor:"#3e7bf0",textStyle:{color:"#000"},brushStyle:{color:"rgba(135,163,206,0.3)"},handleStyle:{color:"#353450",borderColor:"#C5CBE3"},moveHandleStyle:{color:"#B0B6C3",opacity:.3},fillerColor:"rgba(135,163,206,0.2)",emphasis:{handleStyle:{borderColor:"#91B7F2",color:"#4D587D"},moveHandleStyle:{color:"#636D9A",opacity:.7}},dataBackground:{lineStyle:{color:"#3e7bf0",width:1},areaStyle:{color:"#3e7bf0"}},selectedDataBackground:{lineStyle:{color:"#87A3CE"},areaStyle:{color:"#87A3CE"}}},visualMap:{textStyle:{color:"#000"},right:0,left:"auto",top:0,bottom:"auto",padding:[50,20,20,50]},timeline:{lineStyle:{color:"#000"},label:{color:"#000"},controlStyle:{color:"#000",borderColor:"#000"}},calendar:{itemStyle:{color:"#FFF"},dayLabel:{color:"#000"},monthLabel:{color:"#000"},yearLabel:{color:"#000"}},timeAxis:kt(t),logAxis:kt(t),valueAxis:kt(t),categoryAxis:kt(t),pie:{label:{fontFamily:t,fontWeight:"normal",fontStyle:"normal",fontSize:12}},bar:{itemStyle:{border:.5,borderColor:"#C0C0C0"}},line:{symbol:"circle",connectNulls:!0},graph:{color:Tt,roam:!0,draggable:!0},gauge:{title:{color:"#000"}},boxplot:{itemStyle:{borderWidth:1,borderColor:"#000"},progressive:0,boxWidth:[1,100]},candlestick:{itemStyle:{color:"#FD1050",color0:"#0CF49B",borderColor:"#FD1050",borderColor0:"#0CF49B"}},scatter:{label:{fontFamily:t,color:"#000000",position:"top",distance:2},itemStyle:{opacity:1,borderWidth:0},symbolSize:5},grid3D:{viewControl:{projection:"perspective",rotateMouseButton:"left",panMouseButton:"middle",rotateSensitivity:1}}};return e.categoryAxis.splitLine.show=!1,e};
/*!
 * @name JavaScript/NodeJS Merge v1.2.1
 * @author yeikos
 * @repository https://github.com/yeikos/js.merge

 * Copyright 2014 yeikos - MIT license
 * https://raw.github.com/yeikos/js.merge/master/LICENSE
 */
!function(t){var e=function(t){return s(!0===t,!1,arguments)};function i(t,e){if("object"!==o(t))return e;for(var s in e)"object"===o(t[s])&&"object"===o(e[s])?t[s]=i(t[s],e[s]):t[s]=e[s];return t}function s(t,s,n){var a=n[0],r=n.length;(t||"object"!==o(a))&&(a={});for(var l=0;l<r;++l){var h=n[l];if("object"===o(h))for(var c in h)if("__proto__"!==c){var d=t?e.clone(h[c]):h[c];a[c]=s?i(a[c],d):d}}return a}function o(t){return{}.toString.call(t).slice(8,-1).toLowerCase()}e.recursive=function(t){return s(!0===t,!0,arguments)},e.clone=function(t){var i,s,n=t,a=o(t);if("array"===a)for(n=[],s=t.length,i=0;i<s;++i)n[i]=e.clone(t[i]);else if("object"===a)for(i in n={},t)n[i]=e.clone(t[i]);return n},t?module.exports=e:window.merge=e}("object"==typeof module&&module&&"object"==typeof module.exports&&module.exports);const $t=1,Dt=2,Bt=1,It=2,Nt=3,Lt=4,Ft=5,Rt=6,zt=7,Mt=8,Pt=9,jt=10,Gt=12,Ht=13,Vt=14,Ut=15,Wt=16,qt=17,Xt=18,Zt=19,Jt=20,Yt=21,Kt=22,Qt=23,te=24,ee=25,ie=26,se=27,oe=28,ne=29,ae=31,re={ADJUSTMENTS:{order:0,name:"Adjustments",visible:!0,FIELDSETS:{LIMIT_OPTIONS:{order:0,name:"Filtering Options"},SORTING_OPTIONS:{order:1,name:"Sorting Options"}}},PLOT:{order:1,name:"Plot",visible:!0},SERIES:{order:2,name:"Series",visible:!0},FONT_SETTINGS:{order:3,name:"Font & Graphical Settings",visible:!0,FIELDSETS:{GENERAL_OPTIONS:{order:0,name:"General Options"},XAXIS_OPTIONS:{order:1,name:"X-Axis Options"},YAXIS_OPTIONS:{order:2,name:"Y-Axis Options"},ZAXIS_OPTIONS:{order:3,name:"Z-Axis Options"}}}},le={ENTRY:{name:"entry",title:"Number of entries"},VALUE_LOWER:{name:"value_lower",title:"Lower than"},VALUE_HIGHER:{name:"value_higher",title:"Higher than"}},he={HIGHEST:{name:"highest",title:"Highest"},LOWEST:{name:"lowest",title:"Lowest"}},ce={HIGHEST:{name:"highest",title:"Highest"},LOWEST:{name:"lowest",title:"Lowest"},DIFFERENCE:{name:"difference",title:"Difference"},SIMILARITY:{name:"similarity",title:"Similarity"}},de=new Intl.NumberFormat("en-GB",{style:"decimal",notation:"standard",maximumFractionDigits:2}),pe={PIE:"${x} : ${y} (${d}%)",PIE_CB:t=>`${t.value[0]} : ${de.format(t.value[1])} (${t.percent}%)`};class ue extends it{static get properties(){return{viewerVersion:{type:Number},aliases:{type:Object},options:{type:Object},defaultSidebarOptions:{type:Array},defaultParams:{type:String},omicsBox:{type:Object}}}getParam(t){return this.omicsBox[t]}getSidebarModules(){return this.defaultSidebarOptions}setParam(t,e){this.omicsBox[t]!=e&&(this.omicsBox[t]=e,this.dispatchEvent(new CustomEvent("change",{detail:{param:t,value:e}})),this.touchParams())}touchParams(){clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout((()=>{console.log("TIMEOUT: STORING PARAMS 1");let t=this.getJsonParams();console.log("TIMEOUT: STORING PARAMS 2"),this.webSocketRequest.restRequest("params","POST",{jsonParams:t})}),250),console.log("TOUCH PARAMS")}constructor(t){super(),this.webSocketRequest=t,this._updateTimeout=null,this.viewerVersion=2,this.aliases={},this.options={},this.defaultSidebarOptions=[],this.defaultParams=null,this.omicsBox={enableSorting:!1,sortingOption:he.HIGHEST.name,enableLimit:!1,limitOption:le.ENTRY.name,limitNumber:30,showOthers:!1,enableLabels:!0,enableBinning:!1,enableAutomaticBinNumber:!0,enableZoomSlider:!1,binsNumber:0,gridExtraOffsets:{},relativeValues:!1,orientation:$t,fontFamily:"'Roboto'",labelTruncating:{x:[],y:[],z:[]},labelScientificMode:{x:[],y:[],z:[]},seriesInfo:[],forceGlobalUpdateOptions:!1}}getJsonParams(){let t={omicsBox:this.omicsBox,options:Object.assign({},this.options),aliases:this.aliases,viewerVersion:this.viewerVersion,defaultParams:this.defaultParams,defaultSidebarOptions:this.defaultSidebarOptions};delete t.options.dataset;const e=t=>"_obDataset"==t._data?Object.assign({},t,{data:"_obDataset"}):t;return"series"in t.options&&(t.options.series=t.options.series.map(e)),"seriesInfo"in t.omicsBox&&(t.omicsBox.seriesInfo=t.omicsBox.seriesInfo.map((t=>Object.assign({},t,{data:e(t.data)})))),JSON.stringify(t)}loadJsonParams(t){null!=t&&((t=>{Object.keys(t).forEach((e=>{this[e]=Array.isArray(t[e])||"object"!=typeof t[e]||null==t[e]?t[e]:merge.recursive(!1,this[e],t[e])}))})(t),this.defaultParams||(this.defaultParams=JSON.stringify(t)))}performUpdate(t){console.log("EVENT - UPDATED CHART PARAMS",t),this.dispatchEvent(new CustomEvent("change",{detail:{changedProperties:t},bubbles:!1,composed:!1}))}}customElements.define("chart-params",ue);const me={[$t]:30,[Dt]:30},be={[$t]:20,[Dt]:20},ge={[$t]:20,[Dt]:20},xe={[$t]:20,[Dt]:20};class fe extends it{static get properties(){return{top:{type:Number},bottom:{type:Number},left:{type:Number},right:{type:Number},height:{type:Number},offsets:{type:Object}}}constructor(t,e,i,s){super(),this.left=0,this.bottom=0,this.right=0,this.containLabel=!0,this.top=0,this.height=null,this.offsets={},this.orientation=$t,this.chartOptions=null,this.chartDataset=e,this.themeData=i,this.contentRect=t,this.params=s,this._is3Dchart=e.is3DDataset(),this._xAxis=this._is3Dchart?"xAxis3D":"xAxis",this._yAxis=this._is3Dchart?"yAxis3D":"yAxis",this._grid=this._is3Dchart?"grid3D":"grid",this._gridNumber=null}is3Dchart(){return this._is3Dchart}setOrientation(t){this.orientation=t}setChartOptions(t){this.chartOptions=t}addOffset(t,e,i){e in this.offsets||(this.offsets[e]={}),0!=i?this.offsets[e][t]=i:delete this.offsets[e][t]}removeOffset(t){Object.keys(this.offsets).forEach((e=>{delete this.offsets[t]}))}getOffsetSum(t){return t in this.offsets?Object.values(this.offsets[t]).reduce(((t,e)=>t+e),0):0}_getUniqueGrids(){return this._uniqueGrids||(null!=this.chartOptions?this._uniqueGrids=[...new Set(this.chartOptions?.[this._xAxis]?.map((t=>t.gridIndex)))]:this._uniqueGrids=[0]),this._uniqueGrids}_getNumberOfGrids(){return this._getUniqueGrids().length}_hasMultipleAxis(){return null!=this._chartOptions&&(this._chartOptions[this._xAxis].length>1||this._chartOptions[this._yAxis].length>1)}getGridOptions(){return this._is3Dchart?this._get3dGridOptions():this._getNumberOfGrids()<2?this._getOneGridOffsets():this._getMultipleGridOffsets()}_get3dGridOptions(){return{[this._grid]:[{top:"-10%",bottom:"auto",right:"auto",left:"auto",boxWidth:90,boxHeight:90,boxDepth:90}]}}_getOneGridOffsets(){let t=this.themeData.categoryAxis.offset,e=this.orientation==$t?0:t,i=this.orientation==$t?t:0,s=t,o=this._hasMultipleAxis()?t:0;return{[this._grid]:[{top:me[this.orientation]+e+this.getOffsetSum("top"),bottom:xe[this.orientation]+i+this.getOffsetSum("bottom"),right:be[this.orientation]+o+this.getOffsetSum("right"),left:ge[this.orientation]+s+this.getOffsetSum("left"),containLabel:!0}]}}_getResizeGridsInfo(){const t=this.contentRect,e=this.chartDataset.getDatasetStats(),i=me[this.orientation]+this.getOffsetSum("top")+me[this.orientation]/2,s=t.height-i-20*this._getNumberOfGrids(),o=e.reduce(((t,e)=>t+e.records),0),n=e.map((t=>t.records/o*s));return{marginValue:20,topOffset:i,availableHeight:s,gridHeights:n,clientRect:t}}_getChartNameStyleHeight(){return this.contentRect.offsetHeight>0?this.contentRect.offsetHeight-11:window.innerHeight-11}_getMultipleGridOffsets(t,e=!0){const i=this._getUniqueGrids();let s=this.getOffsetSum("right");if(this.orientation==Dt){const t=this.chartDataset.getDatasetStats();let e=null;if(t){const o=kt().axisLabel.margin,n=this._getResizeGridsInfo(),a=t.map(((t,e)=>{let i=null==this.params.omicsBox.labelTruncating.y[e]?30:this.params.omicsBox.labelTruncating.y[e];return null!=i&&t.longest.length>i?t.longest.substring(0,i)+(i>0?"…":""):t.longest})).sort(((t,e)=>e.length-t.length))[0],r=kt().axisLabel,l=Object.assign({},kt().axisLabel,this.chartOptions.yAxis[0].axisLabel),h=Object.assign({},kt().nameTextStyle,this.chartOptions.yAxis[0].nameTextStyle),c=echarts.format.parsePlainText(a,{font:`${l.fontStyle} ${l.fontWeight} ${l.fontSize}px ${this.themeData.categoryAxis.axisLabel.fontFamily}`}),d=this.chartOptions.yAxis.map((t=>t.name)).sort(((t,e)=>e.length-t.length))[0],p=echarts.format.parsePlainText(d,{font:`${h.fontStyle} ${h.fontWeight} ${h.fontSize}px ${this.themeData.categoryAxis.axisLabel.fontFamily}`,overflow:"break",width:this._getChartNameStyleHeight()}),u=c.width+r.margin+p.height+2*n.marginValue,m=Math.min(...t.map((t=>t.minAxis)),0),b=Math.max(...t.map((t=>t.maxAxis)));return e={xAxis:[],yAxis:[],grid:[]},i.forEach((t=>{e.xAxis[t]={min:m,max:b>=100?100*Math.ceil(b/100):10*Math.ceil(b/10),axisLabel:{show:t<1},name:t<1?this.chartOptions.xAxis[t].name:"",nameGap:this.chartOptions.xAxis[t].axisLabel&&!1===this.chartOptions.xAxis[t].axisLabel.show?0:1.07*(this.chartOptions.xAxis[t].axisLabel||kt().axisLabel).fontSize+o},e.yAxis[t]={nameGap:c.width+r.margin+n.marginValue/2},e.grid[t]={left:u,bottom:60,right:s,containLabel:!1,top:n.topOffset+(t>0?n.gridHeights.slice(0,t).reduce(((t,e)=>t+e),0)+n.marginValue*t:0),height:n.gridHeights[t]}})),e}}else console.error("VERTICAL ORIENTATION WITH MULTIPLE DATASETS NOT IMPLEMENTED.")}}customElements.define("chart-grid",fe);class ye extends it{static get properties(){return{relativeValues:{type:Boolean},enableLimit:{type:Boolean},limitOption:{type:String},limitNumber:{type:Number},showOthers:{type:Boolean},enableBinning:{type:Boolean},binsNumber:{type:Number},enableAutomaticBinNumber:{type:Boolean},enableSorting:{type:String},sortingOption:{type:String},sortingAllowed:{type:Number},datasetOption:{type:Boolean}}}constructor(t){super(),this.webSocketRequest=t,this.relativeValues=!1,this.showOthers=!1,this.enableLimit=!1,this.limitOption=le.ENTRY.name,this.limitNumber=30,this.enableBinning=!1,this.enableAutomaticBinNumber=!0,this.binsNumber=0,this.enableSorting=!1,this.sortingOption=he.HIGHEST.name,this.sortingAllowed=!0,this.datasetOption=!0,this._data=[],this._processedData=[],this._processedDataset=[],this._sourceArray=!1,this._initSorted=!1,this._lastEventDetail={},this._supportedAttributes=[],this._cache={},this.type="ChartDataset"}get length(){return this._data.length}is3DDataset(){return!1}isOptionCompatible(){return this.datasetOption}getSupportedAttributes(){return this._supportedAttributes}getDataAttribute(t,e,i){let s=this.getData(t),o=this._sourceArray?e:i;return s&&s.source&&o in s.source?s.source[o]:[]}getExtraInfo({datasetIndex:t,seriesIndex:e,yIndex:i,dataIndex:s}){const o=this.getData(t);if(o&&o.obHiddenSeries){return o.obHiddenSeries[i-1].map((t=>o.source[s][t]))}return""}getDatasetStats(){return!("datasetStats"in this._cache)&&this._processedDataset.length&&(this._cache.datasetStats=this._processedDataset.map(((t,e)=>{let i="",s=1/0,o=-1/0;return t.source.map((t=>{t[0].length>i.length&&(i=t[0]),t[1]<s&&(s=t[1]),t[1]>o&&(o=t[1])})),{longest:i,minAxis:s,maxAxis:o,records:t.source.length}}))),this._cache.datasetStats}clearCache(){this._cache={}}setParam(t,e){this.setParams({[t]:e})}setParams(t){console.log("SETTING DATASET PARAM",t,"PROCESSING DATA"),Object.keys(t).forEach((e=>{this[e]=t[e]})),this._processData()}getProcessedDataset(){return this._processedDataset}getData(t=null){return null===t?this._data:this._data[t]}setData(t){this._data=t}_getHiddenSeriesMinIndex(t=0){return"hiddenSeriesMinIndex"in this._cache||(this._cache.hiddenSeriesMinIndex=[],this._data.map(((t,e)=>{t.obHiddenSeries&&("hiddenSeriesMinIndex"in this._cache||(this._cache.hiddenSeriesMinIndex=[]),this._cache.hiddenSeriesMinIndex[e]=t.obHiddenSeries.reduce(((t,e)=>Math.min(t,...e)),1/0))}))),this._cache.hiddenSeriesMinIndex?.[t]}touchData(){this.webSocketRequest.restRequest("data","POST",{jsonData:JSON.stringify(this._data)})}_getRawData(){if(this.relativeValues){const t=this.getData(0).source.slice().reduce(((t,e)=>t.map(((t,i)=>t+e[i+1]))),new Array(this.getData(0).dimensions.length-1).fill(0));return this.getData(0).source.slice().map(((e,i)=>e.map(((e,i)=>i>0?100*e/t[i-1]:e))))}return this.getData(0).source.slice()}_getSourceData(){const t=this._getRawData();if(this.enableSorting&&this.sortingAllowed){return this._getSortingCallbacks()[this.sortingOption](t)}return t}getDatasetNumber(){return this._data.length}processData(t={}){this._processData(t)}_processData(t={updateLabels:!0}){if(this.getDatasetNumber()){if(this._lastEventDetail={eventData:t},this._initSorted=!1,this.getDatasetNumber()<2&&this._containsData()){const t=this._getSourceData();if(this.enableLimit){var e=this._getLimitCallbacks()[this.limitOption](t),i=e.selectedData;if(this.showOthers){const t=e.remainingData.reduce(((t,e)=>t.map(((t,i)=>t+e[i+1]))),new Array(this.getData(0).dimensions.length-1).fill(0));let s=["others",...t];t.some((t=>0!=t))&&i.push(s),this.enableSorting&&this.sortingAllowed&&(i=this._getSortingCallbacks()[this.sortingOption](i)),i.push(i.splice(i.indexOf(s),1)[0])}this._processedData=i}else if(this.enableBinning){let e;e=!this.enableAutomaticBinNumber&&this.binsNumber?ecStat.histogram(t,{binsNumber:this.binsNumber,dimensions:0,valueDimension:1}):ecStat.histogram(t,{dimensions:0,valueDimension:1});let i=0;this._processedData=e.data.map((t=>(i=Math.max(i,t[4].length),[t[4],t[5]]))),Object.assign(this._lastEventDetail,{binData:!0,binsNumber:e.data.length,maxLabelLength:i})}else this._processedData=t;this._processedDataset=[{dimensions:this._data[0].dimensions,source:this._processedData}]}else this._processedDataset=this._data,this._processedData=null;this.clearCache(),Object.assign(this._lastEventDetail,{data:this._processedData,dataset:this._processedDataset}),this.triggerEvent()}else console.log("NO DATA")}triggerEvent(){this.dispatchEvent(new CustomEvent("change",{detail:this._lastEventDetail}))}_containsData(){return this.length&&this.some((t=>t.source.length))}_getSortingCallbacks(){const t=(t=>t.slice().sort(((t,e)=>e[1]-t[1]))).bind(this),e=(t=>t.slice().sort(((t,e)=>t[1]-e[1]))).bind(this),i=(t=>{let e=this.getSeries().length,i=this._getHiddenSeriesMinIndex(0);return t.slice().sort(((t,s)=>s.slice(1,i).reduce(((t,e)=>t+e))/e-t.slice(1,i).reduce(((t,e)=>t+e))/e))}).bind(this),s=(t=>{let e=this.getSeries().length,i=this._getHiddenSeriesMinIndex(0);return t.slice().sort(((t,s)=>t.slice(1,i).reduce(((t,e)=>t+e))/e-s.slice(1,i).reduce(((t,e)=>t+e))/e))}).bind(this),o=(t=>{let e=this._getHiddenSeriesMinIndex(0);return t.slice().sort(((t,i)=>i.slice(1,e).reduce(((t,e,i,s)=>t+s.slice(i).reduce(((t,i)=>t+Math.abs(e-i)),0)),0)-t.slice(1,e).reduce(((t,e,i,s)=>t+s.slice(i).reduce(((t,i)=>t+Math.abs(e-i)),0)),0)),0)}).bind(this),n=(t=>{let e=this._getHiddenSeriesMinIndex(0);return t.slice().sort(((t,i)=>{let s=i.slice(1,e).reduce(((t,e,i,s)=>t+s.slice(i).reduce(((t,i)=>t+Math.abs(e-i)),0)),0);return t.slice(1,e).reduce(((t,e,i,s)=>t+s.slice(i).reduce(((t,i)=>t+Math.abs(e-i)),0)),0)-s}))}).bind(this);let a;return a=this.getSeries().length<2?{[he.HIGHEST.name]:t,[he.LOWEST.name]:e}:{[ce.HIGHEST.name]:i,[ce.LOWEST.name]:s,[ce.DIFFERENCE.name]:o,[ce.SIMILARITY.name]:n},a}_getLimitCallbacks(){const t=(t=>({selectedData:t.slice(0,this.limitNumber),remainingData:t.slice(this.limitNumber)})).bind(this),e=(t=>{let e=[],i=[];return t.map((t=>{t.slice(1).every((t=>t<this.limitNumber))?e.push(t):i.push(t)})),{selectedData:e,remainingData:i}}).bind(this),i=(t=>{let e=[],i=[];return t.map((t=>{t.slice(1).every((t=>t>this.limitNumber))?e.push(t):i.push(t)})),{selectedData:e,remainingData:i}}).bind(this);return{[le.ENTRY.name]:t,[le.VALUE_LOWER.name]:e,[le.VALUE_HIGHER.name]:i}}map(t){return this._data.map(t)}some(t){return this._data.some(t)}sortByValue(){this._initSorted||(this.getData(0).source.sort(((t,e)=>t[0]-e[0])),this._processData(),this.touchData(),this._initSorted=!0)}getSeries(t=0){return this._data[t]?.dimensions.slice(1,this._getHiddenSeriesMinIndex(t))}}customElements.define("chart-dataset",ye);class ve extends ye{constructor(t){super(t),this.datasetOption=!1,this._supportedAttributes=["nodes","edges"],this._processedData=this._data,this.type="ChartGraphDataset"}triggerEvent(){this.dispatchEvent(new CustomEvent("change",{detail:this._lastEventDetail}))}_processData(){this.triggerEvent()}_containsData(){return this.length&&this.some((t=>t.source.nodes.length))}}customElements.define("chart-graph-dataset",ve);class Se extends ye{constructor(t){super(t),this.datasetOption=!1,this._sourceArray=!0,this._supportedAttributes=["data"],this._processedData=this._data,this.type="Chart3DDataset"}triggerEvent(){this.dispatchEvent(new CustomEvent("change",{detail:this._lastEventDetail}))}getExtraInfo({datasetIndex:t,seriesIndex:e,yIndex:i,dataIndex:s}){const o=this.getData(t);if(o&&o.obHiddenSeries){return o.obHiddenSeries.map((t=>o.source[e][s][t]))}return""}_processData(){this.triggerEvent()}_containsData(){return this.length&&this.some((t=>t.source.length))}is3DDataset(){return!0}}customElements.define("chart-3d-dataset",Se);class we extends ye{constructor(t){super(t),this.datasetOption=!1,this._sourceArray=!0,this._supportedAttributes=["data"],this._processedData=this._data,this.type="ChartAsymmetricDataset"}triggerEvent(){this.dispatchEvent(new CustomEvent("change",{detail:this._lastEventDetail}))}getExtraInfo({datasetIndex:t,seriesIndex:e,yIndex:i,dataIndex:s}){return""}getDataAttribute(t,e,i){let s=this.getData(t);return s&&s.source?s.source:[]}_processData(){this.triggerEvent()}_containsData(){return this.length&&this.some((t=>t.source.length))}is3DDataset(){return!1}}customElements.define("chart-asymmetric-dataset",we);class _e{static handler={get(t,e,i){if("properties"==e)return t.properties;let s=Reflect.get(t.content,e);return"function"==typeof s?s.bind(t.content):s},set(t,e,i,s){if("dataset"!=e)return Reflect.set(t.content,e,i,s);t.content=i}};static createProxy(t){let e={content:new ye(t),properties:ye.properties};return new Proxy(e,_e.handler)}static createDatasetProxy(t,e){let i={content:_e.createDataset(t,e),properties:_e.getTypeProperties(t)};return new Proxy(i,_e.handler)}static createDataset(t,e){return new{ChartDataset:ye,ChartGraphDataset:ve,Chart3DDataset:Se,ChartAsymmetricDataset:we}[t](e)}static getTypeProperties(t){return{ChartDataset:ye.properties,ChartGraphDataset:ve.properties,Chart3DDataset:Se.properties,ChartAsymmetricDataset:we.properties}[t]}}const Ee=t=>class extends t{ready(){this.dispatchEvent(new Event("ready"))}},Ae=Symbol("_cachedApplicationRef"),Oe=Symbol("_mixinRef"),ke=Symbol("_originalMixin"),Te=(t,e)=>(Object.setPrototypeOf(e,t),t[ke]||(t[ke]=t),e),Ce=t=>(Symbol.hasInstance&&!t.hasOwnProperty(Symbol.hasInstance)&&Object.defineProperty(t,Symbol.hasInstance,{value:function(t){const e=this[ke];for(;null!=t;){if(t.hasOwnProperty(Oe)&&t[Oe]===e)return!0;t=Object.getPrototypeOf(t)}return!1}}),t),$e=t=>(t=>Te(t,(e=>{let i=t[Ae];if(i||(i=t[Ae]=Symbol(t.name)),e.hasOwnProperty(i))return e[i];let s=t(e);return e[i]=s,s})))(Ce((t=>Te(t,(e=>{let i=t(e);return i.prototype[Oe]=t[ke],i})))(t))),De=t=>new Be(t);class Be{constructor(t){this.superclass=t}with(){return Array.from(arguments).reduce(((t,e)=>e(t)),this.superclass)}}const Ie=$e((t=>class extends t{getGridInfoFromOptions({chart:t=null,options:e=null,keys:i={}}={}){const s=this.getMarginsFromOptions({chart:t,options:e,keys:i});return{component:s.component,options:e,grid:{position:s.position,margin:s.margin}}}getMarginsFromOptions({chart:t=null,options:e=null,keys:i={}}={}){if(!t||!["style","text","component"].every((t=>i[t])))throw new Error("Invalid params");const s=i.componentIndex||0,o=t.getOption()[i.component][s],n=t.getModel().getComponent(i.component),a=n.axis?n.axis.position:"top",r=["left","right"].includes(a)?t.getHeight():t.getWidth(),l=i.text in e?e[i.text]:o[i.text],h=e.fontStyle||o[i.style].fontStyle||"normal",c=e.fontWeight||o[i.style].fontWeight||"normal",d=e.fontSize||o[i.style].fontSize;let p=0;if(l.length){p=parsePlainText(l,{font:`${h} ${c} ${d}px ${o[i.style].fontFamily}`,overflow:"break",width:r}).height}return{component:i.component,position:a,margin:p}}createSettingsChangeEvent({component:t=null,componentIndex:e=null,property:i=null,options:s=null,grid:o=null}={}){const n=["component","componentIndex","options","property"];if(n.some((t=>null==t)))throw new Error("Missing required params for event: "+n.join(", "));const a={options:{[i]:s},component:t,componentIndex:e};return null!=o&&(a.grid=o),new CustomEvent("settingsChange",{detail:a})}}));customElements.define("fa-icon",class extends it{static get styles(){return[n`:host{display:inline-block;vertical-align:-2px;position:relative;height:1em;width:1em}.icon{position:absolute;top:0;left:0;height:inherit;width:inherit;display:inline-block;font-size:inherit;overflow:visible;fill:var(--icon-color)}.icon:hover{fill:var(--icon-hover-color)}.selected{fill:var(--icon-selected)!important}.selected:hover{fill:var(--icon-selected-hover-color)!important}.disabled{fill:var(--icon-disabled)!important}.disabled:hover{fill:var(--icon-disabled-hover-color)!important}:host([spin]) .icon{animation:spin 2s infinite linear;transform-origin:50% 50%}:host([pulse]) .icon{animation:spin 1s infinite steps(8);transform-origin:50% 50%}use{pointer-events:none}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(1turn)}}`]}render(){return L`<svg class="icon ${this.enabled?this.selected?"selected":"":"disabled"}"><use href="node_modules/web-libraries/resources/icons/${this.g}.svg#${this.n}"></use></svg>`}static get properties(){return{g:{type:String,reflect:!0},n:{type:String,reflect:!0},spin:{type:Boolean,reflect:!0},pulse:{type:Boolean,reflect:!0},selected:{type:Boolean,reflect:!0},enabled:{type:Boolean,reflect:!0}}}constructor(){super(),this.g="",this.n="",this.selected=!1,this.spin=!1,this.pulse=!1,this.enabled=!0}});const Ne=["fontStyle","fontWeight","fontFamily","fontSize","text"];class Le extends it{static get styles(){return[n`
        :host {
            position: abolute;
            --icon-selected: #3e7bf0;
            --icon-selected-hover-color: #3e7bf0;
        }

        :host * {
            box-sizing: border-box;
        }

        div.editor {
            position: absolute; 
            background-color: transparent;
            text-align: center;
            line-height: 1em;
            font-size: 16px;
        }

        div.up-arrow {
            width: 0; 
            height: 0; 
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 5px solid black;
            margin: 0 auto;
        }

        div.down-arrow {
            width: 0; 
            height: 0; 
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid black;
            margin: 0 auto;
        }

        div.wrapper_editor {
            background-color: white;
        }
          
        div.input_editor {
            /*background-color: white;*/
            border: 2px solid black;
            padding: 4px;
            margin: 0 auto;
            width: auto;
            display: inline-block;
            white-space: pre;
            overflow-wrap: break-word;
        }

        ul.editor_options {
            display: flex;
            justify-content: center;
            list-style: none;
            border-radius: 20px;
            border: 1px solid black;
            margin: 0 auto;
            padding: 0;
            width: 180px;
            background-color: #eee;
        }

        ul.editor_options li {
            padding: 3px;
        }

        ul.no_formatting {
            width: 60px;
        }
        
        `]}static get properties(){return{sidebarWidth:{type:Number},options:{type:Object},originalDims:{type:Object},id:{type:String},enableFormatting:{type:Boolean}}}constructor(t,e,i){super(t,e,i),this.id=t,this.chart=e,this.params=i,this.element="text"==i.event.target.type?i.event.target:i.event.target.parent,this.options=Object.assign({},this.element.style)}getId(){return this.id}render(){(this.options.text.match(/\n/g)||"").length;const t=this.element.transform?[this.element.transform[4],this.element.transform[5]]:this.element.position,e=t[0],i=t[1],s=this.element.getBoundingRect().y,o=this.chart.getWidth(),n=this.chart.getHeight(),a=this.element.getBoundingRect().width,r=this.element.getBoundingRect().height;if(0!=this.element.rotation){let t=0;this.params.componentType;let s=-90;e>o/2&&(s=90);let l=parsePlainText(this.options.text,{font:`${this.options.fontStyle} ${this.options.fontWeight} ${this.options.fontSize}px ${this.options.fontFamily}`,overflow:"break",width:n-11}).lines.join("\n"),h=n,c=this.options.fontSize,d=`translateY(-${r+2+4+1}px)`;return"title"!=this.params.componentType&&(t+=i-n/2),L`
        
            <div class="editor" style="transform-origin: top left; transform: rotate(${s}deg) translateX(-50%) ${d};top: calc(50% + ${t}px); left: ${e}px;">
                <div class="wrapper_editor" style="min-width: ${a+11}px;min-height: ${r+10}px;">
                    <div contenteditable="true" 
                        id="input_editor_${this.element.id}"
                        class="input_editor" 
                        style="font-size: ${this.options.fontSize}px;
                        line-height: ${c}px;
                        color: ${this.options.fill};
                        font-family: ${this.options.fontFamily};
                        font-style: ${this.options.fontStyle};
                        font-weight: ${this.options.fontWeight};
                        max-width: ${h}px"
                        @input="${this.handleInputEvent}">${l}</div>
                </div>
                <div class="up-arrow"></div>
                <ul class="editor_options ${this.enableFormatting?"":" no_formatting"}" style="transform: translateY(${this.enableFormatting?"325%":"80%"}) rotate(${-1*s}deg);">
                    ${this.enableFormatting?L`
                        <li @click="${this.handleBoldClick}"><fa-icon g="solid" n="bold" ?selected="${"bold"==this.options.fontWeight}"></fa-icon></li>
                        <li @click="${this.handleStyleClick}"><fa-icon g="solid" n="italic" ?selected="${"italic"==this.options.fontStyle}"></fa-icon></li>
                        <li @click="${this.handleIncreaseSizeClick}"><fa-icon g="solid" n="font"></fa-icon><fa-icon g="solid" n="caret-up" style="margin-left: -6px;"></fa-icon></li>
                        <li @click="${this.handleDecreaseSizeClick}"><fa-icon g="solid" n="font"></fa-icon><fa-icon g="solid" n="caret-down" style="margin-left: -6px;"></fa-icon></li>`:""}
                    <li @click="${this.handleSaveClick}"><fa-icon g="solid" n="check"></fa-icon></li>
                    <li @click="${this.handleCloseClick}"><fa-icon g="solid" n="times"></fa-icon></li>
                </ul>
            </div>
            `}{let t=0;"title"!=this.params.componentType&&(t+=e-o/2);let l,h=o-1,c=parsePlainText(this.options.text,{font:`${this.options.fontStyle} ${this.options.fontWeight} ${this.options.fontSize}px ${this.options.fontFamily}`,overflow:"break",width:h-11}),d=c.lines.join("\n"),p=this.options.fontSize,u=0,m=i<n/2;m?(l=`top: ${i+s}px`,u=`translateY(-${c.lineHeight/2-2}px)`):(l=`bottom: ${n-i}px`,u=`translateY(${c.height+4}px)`);let b=L`<div class="wrapper_editor" style="min-width: ${a+11}px;min-height: ${r+10}px;">
                                        <div contenteditable="true" 
                                            id="input_editor_${this.element.id}"
                                            class="input_editor" 
                                            style="font-size: ${this.options.fontSize}px; 
                                            line-height: ${p}px;
                                            color: ${this.options.fill};
                                            font-family: ${this.options.fontFamily};
                                            font-style: ${this.options.fontStyle};
                                            font-weight: ${this.options.fontWeight};
                                            max-width: ${h}px;"
                                            @input="${this.handleInputEvent}">${d}</div>
                                    </div>`,g=L`<ul class="editor_options ${this.enableFormatting?"":" no_formatting"}">
                                    ${this.enableFormatting?L`
                                        <li @click="${this.handleBoldClick}"><fa-icon g="solid" n="bold" ?selected="${"bold"==this.options.fontWeight}"></fa-icon></li>
                                        <li @click="${this.handleStyleClick}"><fa-icon g="solid" n="italic" ?selected="${"italic"==this.options.fontStyle}"></fa-icon></li>
                                        <li @click="${this.handleIncreaseSizeClick}"><fa-icon g="solid" n="font"></fa-icon><fa-icon g="solid" n="caret-up" style="margin-left: -6px;"></fa-icon></li>
                                        <li @click="${this.handleDecreaseSizeClick}"><fa-icon g="solid" n="font"></fa-icon><fa-icon g="solid" n="caret-down" style="margin-left: -6px;"></fa-icon></li>`:""}
                                    <li @click="${this.handleSaveClick}"><fa-icon g="solid" n="check"></fa-icon></li>
                                    <li @click="${this.handleCloseClick}"><fa-icon g="solid" n="times"></fa-icon></li>
                                </ul>`;return L`
            <div class="editor" style="transform: translateX(-50%) translateX(${t}px) ${u};${l}; left: 50%;">
                ${m?L`${b}<div class="up-arrow"></div>${g}`:L`${g}<div class="down-arrow"></div>${b}`}
            </div>
            `}}updated(t){}handleInputEvent(t){this.content=t.path[0].innerText}handleIncreaseSizeClick(t){this.options.fontSize=Math.min(20,this.options.fontSize+1),this.requestUpdate()}handleDecreaseSizeClick(t){this.options.fontSize=Math.max(5,this.options.fontSize-1),this.requestUpdate()}handleCloseClick(t){this.dispatchEvent(new CustomEvent("exit",{detail:{options:null,editor:this}}))}handleSaveClick(t){let e,i=Ne.reduce(((t,e)=>(t[e]=this.options[e],t)),{});switch(this.params.componentType){case"title":e={text:"text",style:"textStyle"};break;default:e={text:"name",style:"nameTextStyle"}}null!=this.content&&(i.text=this.content.length?this.content:" "),i[e.text]=i.text,delete i.fontFamily,this.dispatchEvent(new CustomEvent("exit",{detail:{options:i,editor:this,optionKeys:e}}))}handleBoldClick(t){this.options.fontWeight="bold"==this.options.fontWeight?"normal":"bold",this.requestUpdate()}handleStyleClick(t){this.options.fontStyle="italic"==this.options.fontStyle?"normal":"italic",this.requestUpdate()}}customElements.define("chart-editor",Le);const Fe=$e((t=>class extends(Ie(t)){constructor(...t){super(...t),this._EchartsEditorMixin={chart:null,chartEditors:{},options:null}}handleEditorChange(t){const e=t.detail.options,i=t.detail.optionKeys,s=t.detail.editor.params;if(null!=e){Array.isArray(this._EchartsEditorMixin.options[s.componentType])?(i.style in this._EchartsEditorMixin.options[s.componentType][s.componentIndex]||(this._EchartsEditorMixin.options[s.componentType][s.componentIndex][i.style]={}),this._EchartsEditorMixin.options[s.componentType][s.componentIndex][i.text]=e.text,Object.assign(this._EchartsEditorMixin.options[s.componentType][s.componentIndex][i.style],e)):(i.style in this._EchartsEditorMixin.options[s.componentType]||(this._EchartsEditorMixin.options[s.componentType][i.style]={}),this._EchartsEditorMixin.options[s.componentType][i.text]=e.text,Object.assign(this._EchartsEditorMixin.options[s.componentType][i.style],e));const o=this.getGridInfoFromOptions({options:t.detail.options,keys:Object.assign({component:s.componentType},t.detail.optionKeys),chart:this._EchartsEditorMixin.chart}),n=this.createSettingsChangeEvent({component:s.componentType,componentIndex:s.componentIndex,property:i.style,options:t.detail.options,grid:o.grid});this.dispatchEvent(n)}delete this._EchartsEditorMixin.chartEditors[t.detail.editor.getId()],this.requestUpdate()}closeEditors(){this.shadowRoot.querySelectorAll("chart-editor").forEach((t=>t.handleCloseClick()))}getEditors(){return Object.values(this._EchartsEditorMixin.chartEditors)}addEditor(t,e){const i=e.event.target;i.getBoundingRect(),i.position;const s=new Le(i.id,t,e);s.addEventListener("exit",this.handleEditorChange.bind(this)),this._EchartsEditorMixin.chartEditors[i.id]=s}setEditorHandlers({chart:t=null,options:e=null}={}){let i=this;const s=["title","xAxis","yAxis"];t.on("dblclick",(function(e){!s.includes(e.componentType)||e.targetType&&"axisName"!=e.targetType||(i.addEditor(t,e),i.requestUpdate())})),Object.assign(this._EchartsEditorMixin,{chart:t,options:e})}})),Re=t=>"string"==typeof t||t instanceof String;class ze extends(De(it).with(Ee,Fe)){static get styles(){return[n`:host{display:block;position:relative;box-sizing:border-box;width:100%;height:100%;min-height:100vh}#chart_container{height:100%}#svg_renderer{top:0;left:0;height:100%;width:100%;visibility:hidden;position:absolute;z-index:-1}#no_data{width:100%;height:100%;display:flex;justify-content:center;align-items:center;font-size:30px;font-weight:700}chart-editor{z-index:100}.tooltip{color:#333}.loader{font-size:10px;margin:50px auto;text-indent:-9999em;width:10em;height:10em;border-radius:50%;background:#000;background:-moz-linear-gradient(left,#000 10%,rgba(0,0,0,0) 42%);background:-webkit-linear-gradient(left,#000 10%,rgba(0,0,0,0) 42%);background:-o-linear-gradient(left,#000 10%,rgba(0,0,0,0) 42%);background:-ms-linear-gradient(left,#000 10%,rgba(0,0,0,0) 42%);background:linear-gradient(to right,#000 10%,rgba(0,0,0,0) 42%);position:relative;-webkit-animation:load3 1.4s infinite linear;animation:load3 1.4s infinite linear;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);position:fixed;top:50%;left:calc(50% - 150px);margin-left:-5em;margin-top:-5em;z-index:999}.loader:before{width:50%;height:50%;background:#000;border-radius:100% 0 0 0;position:absolute;top:0;left:0;content:''}.loader:after{background:#fff;width:75%;height:75%;border-radius:50%;content:'';margin:auto;position:absolute;top:0;left:0;bottom:0;right:0}@-webkit-keyframes load3{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes load3{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}`]}static get properties(){return{sidebarSections:{type:Object}}}constructor(){super(),this.chart=null,this.resizeCallback=null,this.trialMode=!1,this.theme="omicsbox",this.renderer="canvas",this.colorData=Ct().color,this.loading=!0,this.sidebarSections={},this.colorCounter=0,this.predefinedSidebarModules={},this.cache={},this.themeData=Ct(),this.chartSidebar=null,this.chartReady=!1,this.contentRect={width:null,height:null,offsetHeight:null,offsetWidth:null},this.options=null,this.params=null,this.data=null,this.processedData=this.data,this.grid=null,this.echarts_div=window.document.querySelector("#echarts_container"),echarts.registerTheme("omicsbox",this.themeData)}connectedCallback(){super.connectedCallback(),this.setWebsocketRequest(this.wsRequest)}render(){return this._containsData()||this.loading?L`<slot>No slot assigned</slot><div id="svg_renderer"></div>${this.loading?L`<div class="loader">Loading...</div>`:""} ${this.getEditors()}`:L`<div id="no_data">No data available.</div>`}init(){this.contentRect.width=this.getBoundingClientRect().width,this.contentRect.height=this.getBoundingClientRect().height,this.contentRect.offsetHeight=this.offsetHeight,this.contentRect.offsetWidth=this.offsetWidth,this.params.addEventListener("change",(t=>this._paramsUpdatedCallback(t))),this.data.addEventListener("change",(t=>this._dataUpdatedCallback(t))),this.addEventListener("obUpdatedOptions",(t=>this.grid.setChartOptions(this.options))),this._containsData()&&(this._createChart(),this._configureObserver()),this.loading=!1,this.requestUpdate()}getColor(){if(this.colorCounter==this.colorData.length)return this.colorCounter=0,this.colorData[this.colorCounter];{let t=this.colorCounter;return this.colorCounter++,this.colorData[t]}}initializeParams(){if(!this.wsRequest)throw new Error("'wsRequest' is required to initialize the params.");this.params=new ue(this.wsRequest)}initializeDataset(t){if(!t||!this.wsRequest)throw new Error("'datasetType' and 'wsRequest' are required to initialize the dataset.");this.data=_e.createDatasetProxy(t,this.wsRequest),this.processedData=this.data}initializeGrid(){if(!this.data||!this.params)throw new Error("Params and dataset must me initialized before the grid.");this.grid=new fe(this.contentRect,this.data,this.themeData,this.params)}setTrialMode(t){this.trialMode=t}setOrientation(t,e){if(this.params.omicsBox.orientation!=t){this.params.omicsBox.orientation=t,e.series.map((t=>{let e=t.encode.y;t.encode.y=t.encode.x,t.encode.x=e}));const i=this.params.omicsBox.labelTruncating.x,s=this.params.omicsBox.labelScientificMode.x;this.params.omicsBox.labelTruncating.x=this.params.omicsBox.labelTruncating.y,this.params.omicsBox.labelScientificMode.x=this.params.omicsBox.labelScientificMode.y,this.params.omicsBox.labelTruncating.y=i,this.params.omicsBox.labelScientificMode.y=s;for(let i=0;i<e.xAxis.length;i++){let s=e.xAxis[i].name,o=e.xAxis[i].type,n=e.yAxis[i].type,a=e.xAxis[i]._obOriginalType,r=e.yAxis[i]._obOriginalType;if(t==$t){let t;if(e.xAxis[i]=Object.assign(e.xAxis[i]||{},{position:"bottom",type:n,name:e.yAxis[i].name,_obOriginalType:r}),e.yAxis[i]=Object.assign(e.yAxis[i]||{},{type:o,inverse:!1,name:s,_obOriginalType:a}),e.xAxis[i].name.length&&e.xAxis[i].nameTextStyle&&"fontSize"in e.xAxis[i].nameTextStyle){t=echarts.format.parsePlainText(e.xAxis[i].name.length,{font:`${e.xAxis[i].nameTextStyle.fontStyle} ${e.xAxis[i].nameTextStyle.fontWeight} ${e.xAxis[i].nameTextStyle.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:this._getChartNameStyleWidth()}).height}else t=0;this.grid.addOffset("xAxis","bottom",t+11),this.grid.addOffset("xAxis","top",0)}else{let t;if(e.xAxis[i]=Object.assign(e.xAxis[i]||{},{position:"top",type:n,name:e.yAxis[i].name,_obOriginalType:r}),e.yAxis[i]=Object.assign(e.yAxis[i]||{},{type:o,inverse:!0,name:s,_obOriginalType:a}),e.xAxis[i].name.length&&e.xAxis[i].nameTextStyle&&"fontSize"in e.xAxis[i].nameTextStyle){t=echarts.format.parsePlainText(e.xAxis[i].name.length,{font:`${e.xAxis[i].nameTextStyle.fontStyle} ${e.xAxis[i].nameTextStyle.fontWeight} ${e.xAxis[i].nameTextStyle.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:this._getChartNameStyleWidth()}).height}else t=0;this.grid.addOffset("xAxis","top",t+11),this.grid.addOffset("xAxis","bottom",0)}"category"==e.yAxis[i].type?e.yAxis[i].axisLabel=Object.assign(e.yAxis[i].axisLabel||{},{interval:0}):e.yAxis[i].axisLabel=Object.assign(e.yAxis[i].axisLabel||{},{interval:null}),"category"==e.xAxis[i].type?e.xAxis[i].axisLabel=Object.assign(e.xAxis[i].axisLabel||{},{interval:0}):e.xAxis[i].axisLabel&&(e.xAxis[i].axisLabel=Object.assign(e.xAxis[i].axisLabel||{},{interval:null}))}return this.grid.setOrientation(t),this._updateGridOptions(),!0}return!1}getAxisOption(t){return`${t}${this.is3DChart()?"3D":""}`}_getXAxisType(){return this.params.options.xAxis&&this.params.options.xAxis.type||"category"}_getYAxisType(){return this.params.options.yAxis&&this.params.options.yAxis.type||"value"}_getOrientation(){return this.params?(this.params.omicsBox||{}).orientation:$t}_getExtraInfo({seriesIndex:t,yIndex:e,dataIndex:i,datasetIndex:s=0}={}){return this.data.getExtraInfo({datasetIndex:s||0,seriesIndex:t,yIndex:e,dataIndex:i})}_restoreOriginalAxisTypes(){console.log("RESTORING ORIGINAL AXIS"),this.options.yAxis?.map(((t,e)=>{t.type=t._obOriginalType})),this.options.xAxis?.map(((t,e)=>{t.type=t._obOriginalType}))}_replaceVars(t,e){return new Function("return `"+t.replace(/\${extraInfo}/g,"${extraInfo[0]}").replace(/\${/g,"${this.").replace(/extra\[(.*?)\]/g,"extra[this.$1]")+"`;").call(e)}_dataUpdatedCallback(t){if(console.log("DATA UPDATED",t),t.detail.data){t.detail.binData?(this._getOrientation()==$t?(this.options.xAxis[0].type="category",this.options.yAxis[0].type="value",this.params.omicsBox.labelTruncating.x[0]=t.detail.maxLabelLength,this.options.xAxis[0].axisLabel=Object.assign(this.options.xAxis[0].axisLabel||{},{rotate:45})):(this.options.yAxis[0].type="category",this.options.xAxis[0].type="value",this.params.omicsBox.labelTruncating.y[0]=t.detail.maxLabelLength,this.options.xAxis[0].axisLabel=Object.assign(this.options.xAxis[0].axisLabel||{},{rotate:0})),this.params.omicsBox.binsNumber||null==t.detail.binsNumber||this.params.setParam("binsNumber",t.detail.binsNumber)):this._restoreOriginalAxisTypes(),this.options.dataset[0].source=t.detail.data;let e=!t.detail.binData;t.detail.eventData.updateLabels&&this._setLabelTruncatingOptions(e,["xAxis","yAxis"],!e)}else t.detail.dataset&&(this.options.dataset=t.detail.dataset);this._updateOptions("dataset",!1,!1)}_paramsUpdatedCallback(t){let e=t.detail.param,i=t.detail.value;e in this.data.properties&&this.data.setParam(e,i)}_setCache(t,e){"object"==typeof e&&null!==e?(t in this.cache||(this.cache[t]={}),Object.assign(this.cache[t],e)):this.cache[t]=e}_getCache(t){return this.cache[t]}getRangeValue(t){let e=this._getCache("datasetRanges"),i=e?e[t]:null;return i&&i!=1/0&&i!=-1/0?i:null}getXAxisMaxRange(){let t=this._getOrientation()==$t?"xMax":"yMax";return this.getRangeValue(t)}getYAxisMaxRange(){let t=this._getOrientation()==$t?"yMax":"xMax";return this.getRangeValue(t)}_getCSVData(){let t=JSON.parse(this.params.defaultParams);return JSON.stringify({xAxis:t.options[this.getAxisOption("xAxis")].map((t=>t.name)),yAxis:t.options[this.getAxisOption("yAxis")].map((t=>t.name)),zAxis:this.is3DChart()?t.options[this.getAxisOption("zAxis")].map((t=>t.name)):null,datasetType:this.data.type,series:t.options.series.map((t=>t.name))})}_getPNGData(){return this.chart.getDataURL({type:"png",pixelRatio:1})}_getSVGData(){return new Promise(((t,e)=>{if(this.is3DChart())t(null);else if("svg"!=this.renderer){let e=this.shadowRoot.querySelector("#svg_renderer"),i=echarts.init(e,this.theme,{renderer:"svg"}),s=Object.assign({},this.params.omicsBox.forceGlobalUpdateOptions?this.options:this.chart.getOption());s.series=s.series.map((t=>Object.assign({},t,{large:!1}))),i.on("finished",function(){console.log("SVG CHART FINISHED");let e=Ot(i,this.options.legend.show||!1);i.dispose(),t(e),i.setOption({})}.bind(this)),i.setOption(s)}else{let e=Ot(this.chart,this.options.legend.show||!1);t(e)}}))}_restoreSeriesCallbacks(t,e){if("error-bar"==t.originalType)this.options.series[e].tooltip={formatter:t=>`<ul>\n                        <li>Avg: ${t.data[1]}</li>\n                        <li>Min: ${t.data[2]}</li>\n                        <li>Max: ${t.data[3]}</li>\n                        </ul>\n                    `},this.options.series[e].renderItem=(t,e)=>{var i=e.value(0),s=e.coord([i,e.value(3)]),o=e.coord([i,e.value(2)]),n=.1*e.size([1,0])[0],a={stroke:e.visual("color"),fill:null},r={stroke:e.visual("color"),fill:null,lineDash:[3,3]};return{type:"group",children:[{type:"line",shape:{x1:s[0]-n,y1:s[1],x2:s[0]+n,y2:s[1]},style:a},{type:"line",shape:{x1:s[0],y1:s[1],x2:o[0],y2:o[1]},style:r},{type:"line",shape:{x1:o[0]-n,y1:o[1],x2:o[0]+n,y2:o[1]},style:a}]}};else if("markline"==t.originalType)this.options.series[e].renderItem=()=>{};else if("boxplot"==t.type)this.options.series[e].tooltip={formatter:function(t){let e=t.data.value?t.data.value:t.data;return["Name: "+t.name,"upper: "+e[5],"Q3: "+e[4],"median: "+e[3],"Q1: "+e[2],"lower: "+e[1]].join("<br/>")}};else if(t.tooltip&&(t.tooltip.formatter||t.tooltip._orgFormatter)){let i;t.tooltip._orgFormatter?i=t.tooltip._orgFormatter:(Re(t.tooltip.formatter)&&(t.tooltip._orgFormatter=t.tooltip.formatter),i=Re(t.tooltip.formatter)?t.tooltip.formatter:(t.tooltip.formatter||((t,e,i)=>"")).bind(this));const s=JSON.parse(this.options.series[e].tooltip.obExtraLabels||"{}");this.options.series[e].tooltip.formatter=function(e,o,n){let a=this.params.aliases.series&&this.params.aliases.series[e.seriesName]?this.params.aliases.series[e.seriesName]:e.seriesName;if(Re(i)){const o=e.value[e.encode.x[0]],n=e.value[e.encode.y[0]],r=e.value[e.encode.z?.[0]],l={seriesName:a,extraInfo:this._getExtraInfo({seriesIndex:t._index,yIndex:e.encode.y[0],dataIndex:e.dataIndex,datasetIndex:t.datasetIndex}),x:o,y:n,z:r,xy:`${o}_${n}`,extra:s};return this._replaceVars(i,Object.assign({},e,l))}return i(Object.assign({},e,{seriesName:a}),o,n)}.bind(this)}if(t._obPieLabel&&(t.label=Object.assign(t.label||{},{formatter:pe.PIE_CB})),t.label&&(t.label.formatter||t.label._orgFormatter))if(this.params.omicsBox.enableLabels){let i;t.label._orgFormatter?i=t.label._orgFormatter:(Re(t.label.formatter)&&(t.label._orgFormatter=t.label.formatter),i=Re(t.label.formatter)?t.label.formatter:(t.label.formatter||((t,e,i)=>"")).bind(this));const s=JSON.parse(this.options.series[e].label.obExtraLabels||"{}");this.options.series[e].label.show=!0,this.options.series[e].label.formatter=function(e,o,n){let a=this.params.aliases.series&&this.params.aliases.series[e.seriesName]?this.params.aliases.series[e.seriesName]:e.seriesName;if(Re(i)){const o=e.encode.y?e.encode.y[0]:e.encode.value[0],n=e.value[e.encode.x[0]],r=e.value[o],l=e.value[e.encode.z?.[0]],h={seriesName:a,extraInfo:this._getExtraInfo({seriesIndex:t._index,yIndex:o,dataIndex:e.dataIndex,datasetIndex:t.datasetIndex}),x:n,y:r,z:l,xy:`${n}_${r}`,extra:s,d:e.percent||0};return this._replaceVars(i,Object.assign({},e,h))}return i(Object.assign({},e,{seriesName:a}),o,n)}.bind(this)}else this.options.series[e].label.show=!1;this.data.getSupportedAttributes().filter((e=>e in t&&"_obDataset"==t[e])).forEach((e=>{console.log("SERIES DATA",t),t[e]=this.data.getDataAttribute(t.datasetIndex||0,t._index,e),t[`_${e}`]="_obDataset"}))}is3DChart(){return this.data.is3DDataset()}_checkOptions(){this.trialMode?this.options.graphic=[{type:"image",left:"center",top:"middle",z:0,silent:!0,style:{image:"./media/watermark_omicsbox.png",width:609,height:609}}]:delete this.options.graphic;[...new Set(this._getXAxisOptions().map((t=>t.gridIndex)))].length>1&&(this.refreshGridOptions(),this.addEventListener("obUpdatedOptions",(t=>{console.log("MULTIPLE RECEIVED EVENT",t),1==t.detail.options.length&&["yAxis","xAxis"].includes(t.detail.options[0])&&this.refreshGridOptions()})));let t=this._getChartNameStyleWidth(),e=this._getChartNameStyleHeight(),i=kt(this.params.fontFamily);const s={fontWeight:this.themeData.title.textStyle.fontWeight,fontStyle:this.themeData.title.textStyle.fontStyle,fontSize:this.themeData.title.textStyle.fontSize,width:t};"title"in this.options||(this.options.title={}),this.options.title.textStyle={...s,...this.options.title.textStyle||{}},this.options.title.subtextStyle={...this.options.title.subtextStyle||{},width:t};const o={triggerEvent:!0,nameTextStyle:{fontWeight:i.nameTextStyle.fontWeight,fontStyle:i.nameTextStyle.fontStyle,fontSize:i.nameTextStyle.fontSize,width:t},axisLabel:{rotate:0,fontWeight:i.axisLabel.fontWeight,fontStyle:i.axisLabel.fontStyle,fontSize:i.axisLabel.fontSize,formatter:"{value}"},nameLocation:"middle",nameGap:15,splitLine:{show:!1,lineStyle:{type:"solid"}},splitNumber:5,position:"bottom"},n={triggerEvent:!0,nameLocation:"middle",nameGap:10,nameTextStyle:{fontWeight:i.nameTextStyle.fontWeight,fontStyle:i.nameTextStyle.fontStyle,fontSize:i.nameTextStyle.fontSize,width:e},axisLabel:{rotate:0,fontWeight:i.axisLabel.fontWeight,fontStyle:i.axisLabel.fontStyle,fontSize:i.axisLabel.fontSize},splitLine:{show:!0,lineStyle:{type:"solid"}},splitNumber:5,position:"left"};"xAxis"in this.options||this.is3DChart()||(this.options.xAxis=[{}]);const a=this.getAxisOption("xAxis"),r=this.getAxisOption("yAxis"),l=this.getAxisOption("zAxis"),h=this.getAxisOption("grid");if(this.options[a]?.map(((t,e)=>{const i=e;let s;t.name.length||(this.options[h][t.gridIndex].bottom=xe[Dt]),console.log("MERGE xaxis",t,o),this.options[a][e]=merge.recursive(!0,o,t),"category"==this.options[a][e].type?this.options[a][e].axisLabel.interval=0:this.options[a][e].axisLabel.interval=null,this.options[a][e].axisLabel._orgFormatter?s=this.options[a][e].axisLabel._orgFormatter:(Re(this.options[a][e].axisLabel.formatter)&&(this.options[a][e].axisLabel._orgFormatter=this.options[a][e].axisLabel.formatter),s=this.options[a][e].axisLabel.formatter||((t,e)=>t)),this.options[a][e].axisLabel.formatter=function(t,e){var o=this.params.aliases.xAxis&&this.params.aliases.xAxis[t]?this.params.aliases.xAxis[t]:t;const n=this.params.omicsBox.labelTruncating.x[i];return"category"==this.options[a][i].type?o.length>n&&(o=o.substring(0,n)+(n>0?"…":"")):o=0!=n&&this.params.omicsBox.labelScientificMode.x[i]?new Intl.NumberFormat("en-IN",{notation:"scientific",maximumSignificantDigits:n}).format(o):new Intl.NumberFormat("en-GB",{style:"decimal",notation:"standard",maximumFractionDigits:Math.min(n||0,15)}).format(+o),"function"==typeof s?s(o,e):s.replace("{value}",o)}.bind(this)})),"yAxis"in this.options||this.is3DChart()||(this.options.yAxis=[{}]),this.options[r]?.map(((t,e)=>{const i=e;let s;this.options[r][e]=merge.recursive(!0,n,t),"category"==this.options[r][e].type?this.options[r][e].axisLabel.interval=0:this.options[r][e].axisLabel.interval=null,"right"==this.options[r][e].position&&(this.options[r][e].nameRotate=-90),this.options[r][e].axisLabel._orgFormatter?s=this.options[r][e].axisLabel._orgFormatter:(Re(this.options[r][e].axisLabel.formatter)&&(this.options[r][e].axisLabel._orgFormatter=this.options[r][e].axisLabel.formatter),s=this.options[r][e].axisLabel.formatter||((t,e)=>t)),this.options[r][e].axisLabel.formatter=function(t,e){var o=this.params.aliases.yAxis&&this.params.aliases.yAxis[t]?this.params.aliases.yAxis[t]:t;const n=this.params.omicsBox.labelTruncating.y[i];return"category"==this.options[r][i].type?o.length>n&&(o=o.substring(0,n)+(n>0?"…":"")):o=0!=n&&this.params.omicsBox.labelScientificMode.y[i]?new Intl.NumberFormat("en-IN",{notation:"scientific",maximumSignificantDigits:n}).format(o):new Intl.NumberFormat("en-GB",{style:"decimal",notation:"standard",maximumFractionDigits:Math.min(n||0,15)}).format(+o),"function"==typeof s?s(o,e):s.replace("{value}",o)}.bind(this)})),this.options[l]?.map(((t,e)=>{const i=e;let s;this.options[l][e]=merge.recursive(!0,n,t),"category"==this.options[l][e].type?this.options[l][e].axisLabel.interval=0:this.options[l][e].axisLabel.interval=null,"right"==this.options[l][e].position&&(this.options[l][e].nameRotate=-90),this.options[l][e].axisLabel._orgFormatter?s=this.options[l][e].axisLabel._orgFormatter:(Re(this.options[l][e].axisLabel.formatter)&&(this.options[l][e].axisLabel._orgFormatter=this.options[l][e].axisLabel.formatter),s=this.options[l][e].axisLabel.formatter||((t,e)=>t)),this.options[l][e].axisLabel.formatter=function(t,e){var o=this.params.aliases.zAxis&&this.params.aliases.zAxis[t]?this.params.aliases.zAxis[t]:t;const n=this.params.omicsBox.labelTruncating.z[i];return"category"==this.options[l][i].type?o.length>n&&(o=o.substring(0,n)+(n>0?"…":"")):o=0!=n&&this.params.omicsBox.labelScientificMode.z[i]?new Intl.NumberFormat("en-IN",{notation:"scientific",maximumSignificantDigits:n}).format(o):new Intl.NumberFormat("en-GB",{style:"decimal",notation:"standard",maximumFractionDigits:Math.min(n||0,15)}).format(+o),"function"==typeof s?s(o,e):s.replace("{value}",o)}.bind(this)})),"tooltip"in this.options){let t;this.options.tooltip._orgFormatter?t=this.options.tooltip._orgFormatter:(Re(this.options.tooltip.formatter)&&(this.options.tooltip._orgFormatter=this.options.tooltip.formatter),t=Re(this.options.tooltip.formatter)?this.options.tooltip.formatter:(this.options.tooltip.formatter||((t,e,i)=>"")).bind(this));const e=JSON.parse(this.options.tooltip.obExtraLabels||"{}");this.options.tooltip.formatter=function(i,s,o){const n=this.params.aliases.series&&this.params.aliases.series[i.seriesName]?this.params.aliases.series[i.seriesName]:i.seriesName;if(Re(t)){const s=i.value[i.encode.x[0]],o=i.value[i.encode.y[0]],a=i.value[i.encode.z?.[0]],r=this.options.series[i.seriesIndex],l={seriesName:n,extraInfo:this._getExtraInfo({seriesIndex:r._index,yIndex:i.encode.y[0],dataIndex:i.dataIndex,datasetIndex:r.datasetIndex}),x:s,y:o,z:a,xy:`${s}_${o}`,extra:e};return this._replaceVars(t,Object.assign({},i,l))}return t(Object.assign({},i,{seriesName:n}),s,o)}.bind(this)}if("label"in this.options){let t;this.options.label._orgFormatter?t=this.options.label._orgFormatter:(Re(this.options.label.formatter)&&(this.options.label._orgFormatter=this.options.label.formatter),t=Re(this.options.label.formatter)?this.options.label.formatter:(this.options.label.formatter||((t,e,i)=>"")).bind(this));const e=JSON.parse(this.options.label.obExtraLabels||"{}");this.options.label.formatter=function(i,s,o){const n=this.params.aliases.series&&this.params.aliases.series[i.seriesName]?this.params.aliases.series[i.seriesName]:i.seriesName;if(Re(t)){const s=i.value[i.encode.x[0]],o=i.value[i.encode.y[0]],a=i.value[i.encode.z?.[0]],r=this.options.series[i.seriesIndex],l={seriesName:n,extraInfo:this._getExtraInfo({seriesIndex:r._index,yIndex:i.encode.y[0],dataIndex:i.dataIndex,datasetIndex:r.datasetIndex}),x:s,y:o,z:a,xy:`${s}_${o}`,extra:e};return this._replaceVars(t,Object.assign({},i,l))}return t(Object.assign({},i,{seriesName:n}),s,o)}.bind(this)}if("legend"in this.options){let t;this.options.legend._orgFormatter?t=this.options.legend._orgFormatter:(Re(this.options.legend.formatter)&&(this.options.legend._orgFormatter=this.options.legend.formatter),t=this.options.legend.formatter||(t=>t)),this.options.legend.formatter=function(e){const i=this.params.aliases.series&&this.params.aliases.series[e]?this.params.aliases.series[e]:e;return"function"==typeof t?t(i):t.replace("{value}",i)}.bind(this);const e=()=>this.options.series.filter((t=>!t.name.startsWith("dummy"))).map((t=>t.name));this.options.legend.data=e(),this.addEventListener("obUpdatedOptions",(t=>{t.detail.options&&t.detail.options.includes("series")&&(this.options.legend.data=e())}))}this.options.series.map(((t,e)=>{this._restoreSeriesCallbacks(t,e),t.label=Object.assign({fontWeight:this.themeData.pie.label.fontWeight,fontStyle:this.themeData.pie.label.fontStyle,fontSize:this.themeData.pie.label.fontSize},t.label||{})})),this.params.omicsBox.aliases&&this.params.omicsBox.aliases.yTick&&Object.keys(this.params.omicsBox.aliases.yTick).forEach((t=>{let e=Object.keys(this.params.omicsBox.aliases.yTick[t]);"value"==this.options.yAxis[t].type&&(e=e.map(parseFloat)),this.options.yAxis[t].axisLabel=Object.assign(this.options.yAxis[t].axisLabel||{},{customValues:e,formatter:(e,i,s)=>this.params.omicsBox.aliases.yTick[t][e.toString()]}),this.options.yAxis[t].axisTick=Object.assign(this.options.yAxis[t].axisTick||{},{alignWithLabel:!0,customValues:e})})),console.log("OPTIONS ",this.options)}_getAliases(t){return t in this.params.aliases||(this.params.aliases[t]={}),this.params.aliases[t]}_postProcessing(){this._adjustChartMargins(this.options),Object.assign(this.options,this.getMergedGridOptions())}_createChart(t=!1){this.chart=echarts.init(this.echarts_div,this.theme,{renderer:this.renderer});const e=()=>{this.webSocketRequest.restRequest("ready","GET")};this.chart.on("rendered",(()=>{clearTimeout(this._renderedTimeout),this._renderedTimeout=setTimeout((()=>{this.chart.off("rendered"),this.chart.off("finished"),e()}),700)})),this.chart.one("finished",(()=>{this.chart.off("rendered"),clearTimeout(this._renderedTimeout),e()})),t||(this.addEventListener("settingsChange",(t=>{let e=t.detail;console.log("SETTINGS CHANGE",t,this.options),this.closeEditors(),this._updateOptions(e.component,!1),e.grid&&(this.grid.addOffset(e.component,e.grid.position,e.grid.margin?e.grid.margin+11:0),this._updateGridOptions())})),this._setOptions(),this._checkOptions(),this._postProcessing()),this.chartReady=!0,this.chart.setOption(this.options,!0),this.chart.on("datazoom",this._axisRangeChanged.bind(this)),this.chart.on("legendselectchanged",this._axisRangeChanged.bind(this)),this.setEditorHandlers({chart:this.chart,options:this.options}),this.postChartReady()}_axisRangeChanged(t){console.log("AXIS RANGE CHANGED",t),this._setLabelTruncatingOptions(!0)}_updateParams(){this.params.touchParams()}_updateData(){this.webSocketRequest.restRequest("data","POST",{jsonData:JSON.stringify(this.data)})}_getChartNameStyleWidth(){return this.offsetWidth>0?this.offsetWidth-11:window.innerWidth-11}_getChartNameStyleHeight(){return this.offsetHeight>0?this.offsetHeight-11:window.innerHeight-11}_updateAxisGridOptions(t){const e=this.options[t][0].splitLine;this.options[t].map(((i,s)=>{this.options[t][s].splitLine=e})),this._updateOptions(t,!1)}_updateGridOptions(t=!0,e=this.getBoundingClientRect()){this.options&&this.refreshGridOptions()}_registerTheme(t){this.themeData=Ct(t),this.grid&&(this.grid.themeData=this.themeData),echarts.registerTheme("omicsbox",this.themeData)}_updateFontFamilyOptions(t){this.params.setParam("fontFamily",t.detail.value),this._registerTheme(t.detail.value),echarts.dispose(this.chart),this._createChart(!0)}_updateOptions(t=null,e=!1,i=!0){let s;s=null!==t?"string"==typeof t||t instanceof String?{[t]:this.options[t]}:t:{},this.dispatchEvent(new CustomEvent("obUpdatedOptions",{detail:{options:Object.keys(s)}})),this.params.omicsBox.forceGlobalUpdateOptions&&(s=Object.assign(this.params.options,s)),i&&(Object.assign(this.params.options,s),this._updateParams()),this.chart&&this.chartReady&&this.chart.setOption(s,e),console.log("UPDATE OPTIONS",s,this.options),this.closeEditors()}_updateChart(){this._setOptions(),this._checkOptions(),this._postProcessing(),this.chart.setOption(this.options,!0),this._updateParams()}_adjustChartMargins(t,e=this._getChartNameStyleWidth(),i=this._getChartNameStyleHeight()){let s=this.themeData.categoryAxis.nameTextStyle,o=s;if(t.title.text.length){let i=t.title.textStyle?t.title.textStyle:this.themeData.title.textStyle,s=echarts.format.parsePlainText(t.title.text,{font:`${i.fontStyle} ${i.fontWeight} ${i.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:e});t.title.textStyle&&(t.title.textStyle.width=e),this.grid.addOffset("title","top",s.height+11)}else this.grid.addOffset("title","top",0);if(t.title.subtext&&t.title.subtext.length){let i=t.title.subtextStyle?t.title.subtextStyle:this.themeData.title.subtextStyle,s=echarts.format.parsePlainText(t.title.subtext,{font:`${i.fontStyle} ${i.fontWeight} ${i.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:e});t.title.subtextStyle&&(t.title.subtextStyle.width=e),this.grid.addOffset("subtitle","top",s.height)}else this.grid.addOffset("subtitle","top",0);const n=t.xAxis?.find((t=>t.name.length&&"bottom"==t.position));if(n){let t=n.nameTextStyle?n.nameTextStyle:s,i=echarts.format.parsePlainText(n.name,{font:`${t.fontStyle} ${t.fontWeight} ${t.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:e});n.nameTextStyle&&(n.nameTextStyle.width=e),this.grid.addOffset("xAxis","bottom",i.height+11)}else this.grid.addOffset("xAxis","bottom",0);const a=t.xAxis?.find((t=>t.name.length&&"top"==t.position));if(a){let t=a.nameTextStyle?a.nameTextStyle:o,i=echarts.format.parsePlainText(a.name,{font:`${t.fontStyle} ${t.fontWeight} ${t.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:e});a.nameTextStyle&&(a.nameTextStyle.width=e),this.grid.addOffset("xAxis","top",i.height+11)}else this.grid.addOffset("xAxis","top",0);const r=t.yAxis?.find((t=>t.name.length&&"left"==t.position));if(r){let t=r.nameTextStyle?r.nameTextStyle:o,e=echarts.format.parsePlainText(r.name,{font:`${t.fontStyle} ${t.fontWeight} ${t.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:i});r.nameTextStyle&&(r.nameTextStyle.width=i),this.grid.addOffset("yAxis","left",e.height+11)}else this.grid.addOffset("yAxis","left",0);const l=t.yAxis?.find((t=>t.name.length&&"right"==t.position));if(l){let t=l.nameTextStyle?l.nameTextStyle:s,e=echarts.format.parsePlainText(l.name,{font:`${t.fontStyle} ${t.fontWeight} ${t.fontSize}px ${this.params.omicsBox.fontFamily}`,overflow:"break",width:i});l.nameTextStyle&&(l.nameTextStyle.width=i),this.grid.addOffset("yAxis","right",e.height+11)}else this.grid.addOffset("yAxis","right",0);t.visualMap.some((t=>t.show))&&this.grid.addOffset("visualMap","right",100),"legend"in t&&t.legend.show&&this.grid.addOffset("legend","bottom",31)}_defaultResizeCB(t){for(const t of this._lastResizeEntries){if(console.log("Resize detected on: ",this,Math.floor(Date.now()/1e3),t),this._resizeProcess)return console.log("Resizing stopped: in the middle of a previous rendering."),clearTimeout(this._resizeTimer),void(this._resizeTimer=setTimeout((()=>this._defaultResizeCB),250));this._resizeProcess=!0,t.contentRect.width!=this.contentRect.width||t.contentRect.height!=this.contentRect.height?(this.contentRect.width=t.contentRect.width,this.contentRect.height=t.contentRect.height,this.contentRect.offsetHeight=this.offsetHeight,this.contentRect.offsetWidth=this.offsetWidth,this._adjustChartMargins(this.options,t.contentRect.width-11,t.contentRect.height-11),this._updateOptions(Object.assign({title:this.options.title},this.getMergedGridOptions()),!1,!1),this.chart.resize(),this.resizeCallback&&this.resizeCallback(t.contentRect)):console.log("Skipping resize: same dimensions"),this._resizeProcess=!1}}_configureObserver(){this._ro&&this._ro.disconnect(),this._ro=new At(((t,e)=>{clearTimeout(this._resizeTimer),this.closeEditors(),this._lastResizeEntries=t,this._resizeTimer=setTimeout((()=>this._defaultResizeCB()),250)})),this._ro.observe(this)}_wsServerCallback(t){console.log("SERVER CALLBACK ",t);const e=function(t){let e={};return"filepath"in t&&(e.filepath=t.filepath),"userselected"in t&&(e.userselected=t.userselected),e};switch(t.action){case"getPDF":this._getSVGData().then((i=>this.webSocketRequest.restRequest("dataPDF","POST",Object.assign({dataSVG:i},e(t)))));break;case"getPNG":this.webSocketRequest.restRequest("dataPNG","POST",Object.assign({dataPNG:this._getPNGData()},e(t)));break;case"getCSV":this.webSocketRequest.restRequest("dataCSV","POST",Object.assign({dataCSV:this._getCSVData()},e(t)))}}_setOptions(){const t="none";this.options={animation:!1,title:{left:"center",triggerEvent:!0,top:10},legend:{top:"bottom",type:"scroll"},tooltip:{formatter:function(t,e,i){let s,o;return Array.isArray(t.data)?(t.encode.x&&t.encode.y?this._getOrientation()==Dt?(s=t.value[t.encode.y[0]],o=t.value[t.encode.x[0]]):(s=t.value[t.encode.x[0]],o=t.value[t.encode.y[0]]):(s=t.data[0],o=t.data[1]),s.length?this.params.options.series.length>1?`<div class="tooltip">\n                        <h4 style="margin-top: 0;">${t.seriesName}</h4>\n                        <span>${s}: ${o}</span>\n                        </div>`:`<b>${t.data[0]}</b>: ${t.data[1]}`:this.params.options.series.length>1?`<div class="tooltip">\n                        <h4 style="margin-top: 0;">${t.seriesName}</h4>\n                        <span>${o}</span>\n                        </div>`:`${t.data[1]}`):this.params.options.series.length>1?`<div class="tooltip">\n                        <h4 style="margin-top: 0;">${t.seriesName}</h4>\n                        <span>${t.name}</span>\n                        </div>`:`${t.name}`}.bind(this)},dataZoom:[{type:"slider",show:this.params.omicsBox.enableZoomSlider,xAxisIndex:[0],bottom:15,filterMode:t,disabled:!this.hasZoomSliderAvailable()},{type:"slider",show:this.params.omicsBox.enableZoomSlider,yAxisIndex:[0],right:15,filterMode:t,disabled:!this.hasZoomSliderAvailable()},{type:"inside",xAxisIndex:[0],filterMode:t,disabled:!this.hasZoomAvailable()},{type:"inside",yAxisIndex:[0],filterMode:t,disabled:!this.hasZoomAvailable()}]},this.data.isOptionCompatible()&&(this.options.dataset=this.data.map((t=>({dimensions:t.dimensions,source:t.source.slice()})))),this.options=merge.recursive(!1,this.options,this.params.options),this.data.triggerEvent(),this.options.series=this.params.omicsBox.seriesInfo.filter((t=>t.enabled)).map((t=>t.data)),this.grid.setChartOptions(this.options);const e=this.grid.getGridOptions();e&&!this.is3DChart()&&(this.options.grid[0]=Object.assign(e.grid[0],this.options.grid[0])),console.log(this.options,this.params.options),this.hasSidebarOption(Ft)&&!this.hasSidebarOption(ie)&&this.params.defaultSidebarOptions.push(ie)}setWebsocketRequest(t){this.webSocketRequest=t,t.args.serverCallback=this._wsServerCallback.bind(this),this.webSocketRequest.restRequest("info","GET",null,(t=>{let e=JSON.parse(t.jsonData),i=JSON.parse(t.jsonParams),s=e[0].obType||"ChartDataset";new Promise((function(t,e){if("Chart3DDataset"==s){let i=document.createElement("script");i.src="./node_modules/web-libraries/echarts/dist/echarts-gl.min.js",i.onload=()=>t(),i.onerror=()=>e(new Error("Script load error for 'echarts-gl.min.js'")),window.document.head.append(i)}else t()})).then((()=>{this.initializeParams(),this.initializeDataset(s),this.initializeGrid(),this.setTrialMode(!("jsonTrialMode"in t)||t.jsonTrialMode),this.setJsonInfo(e,i),this.init()}))}))}setJsonInfo(t,e){this._setJsonData(t),this._setJsonParams(e)}_setJsonData(t){this.data.setData(t)}_containsData(){return this.data?._containsData()}_setJsonParams(t){if(null!=t){this.params.loadJsonParams(t);let e=Object.keys(this.data.properties).filter((t=>t in this.params.omicsBox)).reduce(((t,e)=>(t[e]=this.params.omicsBox[e],t)),{});console.log("DATASET SETTINGS",e),this.data.setParams(e),this.data.sortingAllowed=this.hasSortingAllowed(),!this.params.omicsBox.specificTransformed&&this._containsData()&&this._setSpecificSettings(),this._registerTheme(this.params.getParam("fontFamily"))}}_barClipLayout(t){t.eachSeries((t=>{var e=t.getData();e.each((i=>{var s=e.getItemLayout(i);if(s){var o=t.coordinateSystem.master.getRect();s.x<o.x&&(s.width=s.width-(o.x-s.x),s.x=o.x),s.x+s.width>o.x+o.width&&(s.width=o.x+o.width-s.x),s.width<0&&(s.width=0),s.y>o.y+o.height&&(s.height=s.height-(o.y+o.height-s.y),s.y=o.y+o.height);var n=o.y+o.height-s.y;n+Math.abs(s.height)+65>o.y+o.height&&(s.height=-(o.y+o.height-65-n)),s.height>0&&(s.height=0)}}))}))}_setSpecificSettings(){const t={boxplot:t=>{this.data.map(((t,e)=>{const i=this._getDatasetByRowSeries(t),s=t.dimensions.slice(1);i[0];const o=echarts.dataTool.prepareBoxplotData(i.slice(1)),n=[{type:"boxplot",data:o.boxData.map(((t,e)=>({value:t,itemStyle:this.params.options.series[e].itemStyle||{}}))),name:"boxplotData"},{name:"outliers",type:"scatter",data:o.outliers,itemStyle:{color:"transparent",borderWidth:1,borderColor:"black"}}];this.params.options.series=n,this.params.options.xAxis[e].data=s,this.params.options.yAxis[e].boundaryGap=["5%","5%"],this.params.options.yAxis[e].splitLine={show:!1},this.params.options.xAxis[e].axisLine={onZero:!1},this.params.options.legend={show:!1}})),this.params.omicsBox.forceGlobalUpdateOptions=!0},"boxplot-trimmed":t=>{this.params.options.xAxis[0].data=this.data.getData(0).source.map((t=>t.name)),this.params.options.yAxis[0].boundaryGap=["5%","5%"],this.params.options.yAxis[0].splitLine={show:!1},this.params.options.xAxis[0].axisLine={onZero:!1},this.params.options.legend={show:!1}},"processed-boxplot":t=>{if(t.length>5)log.error("Incorrect number of selected series for processed boxplot, there must be 5");else{const e={type:"boxplot",name:"boxplotdata"};let i,s,o,n;t.map((t=>{console.log("PROCESSED BOXPLOT REMOVING",t,this.params.options.series),this.params.options.series.splice(this.params.options.series.indexOf(t),1),i=t.datasetIndex,s=t.yAxisIndex,o=t.xAxisIndex,n=t.itemStyle}));const a=[];e.data=this.data.getData(i).source.map((t=>(a.push(t[0]),t.slice(1)))),e.xAxisIndex=o,e.yAxisIndex=s,e.itemStyle=n,e.itemStyle.borderColor="#000",this.params.options.xAxis[o].data=a,this.params.options.series.unshift(e),console.log("PROCESSED BOXPLOT ADDED",this.params.options.series)}},scatter:t=>{this.params.options.series.map((t=>{t.large=!("visualMap"in this.params.options&&this.params.options.visualMap.length),t.largeThreshold=2e3,this.params.options.yAxis[t.yAxisIndex].boundaryGap=["0%","0.01%"]}))},histogram:t=>{const e=this._getDatasetByRowSeries(this.data.getData(0)).map(((t,e)=>({type:"bar",itemStyle:this.params.options.series[e].itemStyle||{},data:ecStat.histogram(t)})));this.params.options.series=e},"horizontal-bar":t=>{this.setOrientation(Dt,this.params.options)},"horizontal-stacked-bar":t=>{this.setOrientation(Dt,this.params.options)},pie:t=>{if(console.log(this.params.options),this.params.options.series.map((t=>{t.encode=Object.assign(t.encode||{},{value:1,itemName:0}),t.center=["50%","50%"],t.radius="70%",t.label||(t.label={formatter:pe.PIE},t._obPieLabel=!0)})),this.params.options.xAxis.map(((t,e)=>{this.params.options.xAxis[e]=Object.assign(this.params.options.xAxis[e]||{},{show:!1})})),this.params.options.yAxis.map(((t,e)=>{this.params.options.yAxis[e]=Object.assign(this.params.options.yAxis[e]||{},{show:!1})})),"visualMap"in this.params.options&&this.params.options.visualMap.length){let t=this.params.options.visualMap[0],e=t.inRange.color;"others"in e||(t.categories.push("others"),e.others="#DBDBDB")}},area:t=>{1==this.data.length&&"value"==this.params.options.xAxis[0].type&&this.data.sortByValue(),this.params.options.series.map(((t,e)=>{this.params.options.series[e].areaStyle=Object.assign(this.params.options.series[e].areaStyle||{},{opacity:1}),this.params.options.series[e].lineStyle=Object.assign(this.params.options.series[e].lineStyle||{},{opacity:0,color:this.params.options.series[e].areaStyle.color}),this.params.options.series[e].itemStyle=Object.assign(this.params.options.series[e].itemStyle||{},{opacity:0,color:this.params.options.series[e].areaStyle.color})}))},line:t=>{1==this.data.length&&"value"==this.params.options.xAxis[0].type&&this.data.sortByValue()}};(()=>{this.params.options?.yAxis?.map(((t,e)=>{t._obOriginalType=t.type})),this.params.options?.xAxis?.map(((t,e)=>{t._obOriginalType=t.type}))})();const e=new Set(this.params.options.series.map((t=>t.originalType)));e.size>1&&console.log("Multiple series types encountered in received params. Specific transformations are EXPERIMENTAL in this case, or they might be already transformed.",e),e.forEach((e=>{if(e in t){const i=this.params.options.series.filter((t=>t.originalType==e));t[e](i)}})),(()=>{1!=this.params.options.series.length||this.params.options.legend||(this.params.options.legend=Object.assign(this.params.options.legend||{},{show:!1}));let t=this.getUniqueGridsNumber();this.params.options.xAxis?.map(((e,i)=>{1==t&&(this.params.options.xAxis[i].axisLabel=Object.assign({rotate:"category"==e.type?45:0},this.params.options.xAxis[i].axisLabel||{}))}));const e=(t,e,i,s=!1)=>{const o={type:"custom",originalType:"markline",name:`dummy_${t}`,tooltip:{formatter:i},renderItem:()=>{},silent:s,z:e,legendHoverLink:!1,_obEditable:!1};return this.params.options.series.push(o),o};if("markLine"in this.params.omicsBox){const t=t=>`${t.name} (${t.xAxis||t.yAxis})`;this.params.omicsBox.markLine.map(((i,s)=>{e(`markline${s}`,2,t(i)).markLine={symbol:["none","none"],label:{show:!1},data:[i],silent:!0}}))}"markArea"in this.params.omicsBox&&this.params.omicsBox.markArea.map(((t,i)=>{const s=e(`markArea${i}`,1,null,!0);console.log("MARK AREA",t),s.markArea=t,s.markArea.label={show:!1}})),this.params.options.legend=Object.assign({show:this.params.options.series.length>1},this.params.options.legend||{}),this.params.options.grid?.length>1&&(this.params.options.legend.show=!1);let i=this._getOrientation()==$t?"bottom":"top";this.params.options.xAxis?.map((t=>{t.position||(t.position=i)})),this.params.options.yAxis?.map((t=>{t.position||(t.position="left")})),this.params.options.series.map(((t,e)=>{t.itemStyle&&t.itemStyle.color&&"borderColor"in t.itemStyle&&t.itemStyle.color!=t.itemStyle.borderColor&&(t._obCustomBorderColor=!0)})),this.params.omicsBox.seriesInfo=this.params.options.series.map(((t,e)=>(t._index=e,{index:e,enabled:!0,data:t}))),this.hasSidebarOption(Ht)&&"value"==this.params.options.xAxis[0].type&&this.data.sortByValue()})(),this.params.omicsBox.specificTransformed=!0,this._updateParams()}_getDatasetByRowSeries(t){return t.dimensions.map(((e,i)=>t.source.map((t=>t[i]))))}hasZoomAvailable(){const t=["boxplot"],e=(this.options||this.params.options).series.some((e=>t.includes(e.type)));return!this.is3DChart()&&!e&&this.hasSidebarOption(Qt)&&!this.hasMultipleAxis(this.params.options)}hasZoomSliderAvailable(){return this.hasZoomAvailable()}hasSortingAllowed(){return!("value"==this.params?.options?.xAxis?.[0]?.type&&this.params.options?.series?.some((t=>"line"==t.type)))}hasCategoryColors(){let t=this.options.visualMap.length?this.options.visualMap[0]:{};return 1==this.options.series.length&&t.inRange&&!Array.isArray(t.inRange.color)}hasVisibleAxis(){return!this.options.series.some((t=>"pie"==t.type))}hasXAxis(){return this.options.xAxis?.length||this.options.xAxis3D?.length}hasYAxis(){return this.options.yAxis?.length||this.options.yAxis3D?.length}hasZAxis(){return this.options.zAxis3D?.length}hasSidebarOption(t){return this.params.defaultSidebarOptions.includes(t)}hasSymbols(){return this.options.series.some((t=>t.symbol&&!1!==t._obEditable&&!1!==t.showSymbol))}hasMultipleAxis(t=this.options){return t.xAxis?.length>1||t.yAxis?.length>1}hasYTicksAliases(){return this.params.omicsBox.aliases&&this.params.omicsBox.aliases.yTick}hasXTicksAliases(){return this.params.omicsBox.aliases&&this.params.omicsBox.aliases.xTick}hasZTicksAliases(){return this.params.omicsBox.aliases&&this.params.omicsBox.aliases.zTick}hasBothValueOrgAxis(){return this.options.xAxis.some((t=>"value"==t._obOriginalType))&&this.options.yAxis.some((t=>"value"==t._obOriginalType))}getUniqueGridsNumber(){return[...new Set(this._getXAxisOptions().map((t=>t.gridIndex)))].length}getSymbolSize(){let t=this.options.series.find((t=>t.symbol&&!1!==t._obEditable));return t?t.symbolSize||1:0}getDatasetDims(){return{rows:this.data.getData(0).source.length,cols:(this.data.getData(0).source[0]||[]).length}}_getXAxisOptions(){return this.params.options.xAxis||this.params.options.xAxis3D}_getYAxisOptions(){return this.params.options.yAxis||this.params.options.yAxis3D}_getEchartsCoordinateSystem(){if(this.chart){let t=this.chart._coordSysMgr?this.chart._coordSysMgr.getCoordinateSystems():[];return t.length?t[0]:null}return null}_getEchartAxisComponent(t,e){let i=this._getEchartsCoordinateSystem();return i?i.getAxis(t,e):null}getEchartsAxisInterval(t,e){let i=this._getEchartAxisComponent(t,e);return i&&i.scale&&i.scale._interval?i.scale._interval:null}_setLabelTruncatingOptions(t=!1,e=["xAxis","yAxis"],i=!1){if(e.includes("xAxis")&&(!t&&this.params.omicsBox.labelTruncating.x.length||this.options[this.getAxisOption("xAxis")].map(((t,e)=>{let i=this.getEchartsAxisInterval("x",e),s=null;null!=i&&(s=-1!=i.toString().indexOf(".")?i.toString().slice(i.toString().indexOf(".")).length-1:0),this.params.omicsBox.labelTruncating.x[e]=null!=s?s:this.params.omicsBox.labelTruncating.x[e]||30,this.params.omicsBox.labelScientificMode.x[e]=!1}))),e.includes("yAxis")&&(!t&&this.params.omicsBox.labelTruncating.y.length||this.options[this.getAxisOption("yAxis")].map(((t,e)=>{let i=this.getEchartsAxisInterval("y",e),s=null;null!=i&&(s=-1!=i.toString().indexOf(".")?i.toString().slice(i.toString().indexOf(".")).length-1:0),this.params.omicsBox.labelTruncating.y[e]=null!=s?s:this.params.omicsBox.labelTruncating.y[e]||30,this.params.omicsBox.labelScientificMode.y[e]=!1}))),t||i){let t=e.reduce(((t,e)=>(t[e]=this.options[e],t)),{});this._updateOptions(t,!1,!1)}}postChartReady(){this.is3DChart()||this._setLabelTruncatingOptions(!1),this.ready()}getMergedGridOptions(){this.grid.setChartOptions(this.options);const t=this.grid.getGridOptions();if(t){return Object.keys(t).reduce(((e,i)=>(e[i]=[],t[i].map(((t,s)=>{e[i][s]=Object.assign(this.options[i][s],t||{})})),e)),{})}return{}}refreshGridOptions(){this._updateOptions(this.getMergedGridOptions())}getChart(){return this.chart}updateSeriesCallbacks(){this.options.series.map(((t,e)=>this._restoreSeriesCallbacks(t,e))),this._updateOptions("series",!1,!0)}}customElements.define("chart-viewer",ze);window.utils=class{static get characters(){return"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"}static get months(){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}static genId(t){return(t=0==(t=t||"").length?t:t+"-")+this.randomString(4)+this.getRandomInt(1e3,9999)}static randomString(t){t=t||10;for(var e="",i=0;i<t;i++)e+=this.characters.charAt(this.getRandomInt(0,this.characters.length-1));return e}static getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}static isString(t){return"[object String]"===Object.prototype.toString.call(t)}static pick(t,e){let i=0;const s=e.split("."),o=s.length;for(;null!=t&&i<o;)t=t[`${s[i++]}`];return null!=t?t:""}static ifdef(t,e){return""!==this.pick(t,e)}};customElements.define("select-down",class extends it{static get styles(){return[n`:host{display:block;position:relative;box-sizing:border-box;background-color:#fff;cursor:pointer;outline:transparent solid 0;border:1px solid var(--divider-color)}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:0 0}::-webkit-scrollbar-thumb{background:#aaa;border-radius:8px}.d-flex{display:flex}.ai-c{align-items:center}.flex{flex:1;flex-basis:.000000001px}#main{position:relative;box-sizing:border-box;width:100%;height:100%}#main.disabled{color:var(--text-color-disabled)}#text{box-sizing:border-box;font-size:inherit;font-family:inherit;color:inherit;overflow:hidden;text-overflow:clip;white-space:nowrap;padding:0 5px;width:100%}#list{min-width:calc(100% + 2px);position:absolute;z-index:1;left:-1px;box-sizing:border-box;display:none;top:calc(100% - 0);background-color:inherit;border:1px solid var(--divider-color);box-shadow:0 3px 10px rgba(0,0,0,.2);max-height:var(--select-down-list-max-height)}#input{display:block;box-sizing:border-box;color:inherit;height:16px;margin-top:1px;padding:0;border-width:0;outline:0;width:100%}#input::placeholder{opacity:1;color:var(--text-color)}[n=search]{--icon-color:var(--text-color);--icon-hover-color:var(--text-color)}[n=angle-down]{cursor:pointer}.item{padding:2px 5px;cursor:pointer}.item:hover{background-color:var(--hover-color)}.item[data-checked]{background-color:var(--selected-color)}.arrowsel{background-color:var(--text-color)!important;color:#fff!important}`]}render(){return L`<div id="main" class="d-flex ai-c ${this.enabled?"":"disabled"}" @click="${this.handleClick}">${this.enableFilter?L`<fa-icon g="solid" n="search" style="margin-left:5px"></fa-icon><div id="text" class="flex"><input id="input" type="text" placeholder="${this.getOptionTitle(this.selectedOption)}" @input="${this.handleFilterInput}" @keydown="${this.handleKeyDown}"></div>`:L`<div id="text" class="flex">${this.getOptionTitle(this.selectedOption)}</div>`}<fa-icon g="solid" n="angle-down" style="margin-right:5px" .enabled="${this.enabled}"></fa-icon></div><div id="list">${this.options.map(((t,e)=>this.computeFilter(this.filterString,t)?L`<div class="item" ?data-checked="${this.isSelected(t)}" .option="${t}" @mousedown="${this.handleSelect}"><div style="white-space:nowrap;padding:0 5px">${this.getOptionTitle(t)}</div></div>`:""))}</div>`}static get properties(){return{options:{type:Array,hasChanged:(t,e)=>!0},selectedOption:{type:Object},optionName:{type:String},optionTitle:{type:String},enableFilter:{type:Boolean,reflect:!0},filterString:{type:String},enabled:{type:Boolean}}}_set(t,e){let i=`_${t}`,s=this[i];this[i]=e,this.requestUpdate(t,s)}set options(t){this._set("options",t),this._checkSelected()}get options(){return this._options}set selectedOption(t){this._set("selectedOption",t)}get selectedOption(){return this._selectedOption}constructor(){super(),this.options=[],this.selectedOption=this.options[0],this.optionName="name",this.optionTitle="title",this.enableFilter=!1,this.enabled=!0,this.setAttribute("tabindex","-1"),this.addEventListener("blur",(t=>{this.hideList()}))}getSelection(){return this.selectedOption}isSelected(t){return this.selectedOption==t}getOptionTitle(t){var e="";return null!=t&&(e=utils.isString(t)?t:t[this.optionTitle]),e}getOptionName(t){var e="";return null!=t&&(e=utils.isString(t)?t:t[this.optionName]),e}handleClick(t){if(this.enabled){let e=this.renderRoot.querySelector("#input");t.target!=e&&this.toggleList(t)}}toggleList(t){""===this.renderRoot.querySelector("#list").style.display?this.showList():this.hideList()}showList(){this.renderRoot.querySelector("#list").style.display="block"}hideList(){this.renderRoot.querySelector("#list").style.display=""}handleSelect(t){this.select(t.currentTarget.option)}select(t){this.selectedOption=t,this.hideList(),this.filterString="";let e=this.renderRoot.querySelector("#input");null!=e&&(e.value=""),this.dispatchEvent(new CustomEvent("select",{bubbles:!0,composed:!0,detail:this.getSelection()}))}selectByIndex(t){if(null!=this.options[t])return this.selectedOption=this.options[t],this.hideList(),this.dispatchEvent(new CustomEvent("select",{bubbles:!0,composed:!0,detail:this.getSelection()})),this.selectedOption}selectByName(t){for(var e=-1,i=0;i<this.options.length;i++){var s=this.options[i];if(this.getOptionName(s)==t){e=i;break}}if(e>-1)return this.selectByIndex(e)}_checkSelected(){if(null!=this.selectedOption){for(var t=!1,e=0;e<this.options.length;e++){var i=this.options[e];if(this.getOptionName(i)===this.getOptionName(this.selectedOption)){this.selectedOption=i,t=!0;break}}t||(this.selectedOption=null)}}addOption(t){this.options.push(t),this.options=this.options}handleFilterInput(t){this.filterString=t.currentTarget.value}handleKeyDown(t){let e=this.renderRoot.querySelector("#list");if(13!=t.keyCode){if(38==t.keyCode||40==t.keyCode){t.preventDefault();let s=e.querySelectorAll(".item");for(var i=0;i<s.length;i++){s[i].setAttribute("arrowidx",`${i}`)}let o=0,n=s.length-1;38==t.keyCode&&(null==this.pos?this.pos=n:(this.pos--,-1==this.pos&&(this.pos=n)),this._applyArrowSelection()),40==t.keyCode&&(null==this.pos?this.pos=o:(this.pos++,this.pos==s.length&&(this.pos=o)),this._applyArrowSelection())}else{let t=e.querySelector(".arrowsel");null!=t&&t.classList.remove("arrowsel"),this.pos=null}this.showList()}else{let t=e.querySelector(".arrowsel");null!=t&&this.select(t.option)}}_applyArrowSelection(){let t=this.renderRoot.querySelector("#list"),e=t.querySelector(".arrowsel");null!=e&&e.classList.remove("arrowsel");let i=t.querySelector(`[arrowidx='${this.pos}']`);null!=i&&i.classList.add("arrowsel")}computeFilter(t,e){if(t&&""!=t){t=t.toLowerCase();let i=this.getOptionTitle(e).toLowerCase(),s=this.getOptionName(e).toLowerCase();return-1!=i.indexOf(t)||-1!=s.indexOf(t)}return!0}});customElements.define("input-button",class extends it{static get styles(){return[n`:host{display:inline-flex;justify-content:center;align-items:center;position:relative;box-sizing:border-box;cursor:pointer;user-select:none;background-color:var(--input-button-back-color);border:1px solid var(--input-border-color);height:25px;line-height:100%;padding:0 .5em;transition:background-color .15s}:host([shdw]){box-shadow:2px 2px 3px 0 rgba(125,125,125,.25)}:host(:hover){background-color:var(--input-button-back-hover-color)}:host([shdw]:hover){box-shadow:2px 2px 3px 0 rgba(125,125,125,.5)}:host(:active){background-color:var(--input-button-back-active-color)}:host(.disabled:active){background-color:var(--input-button-back-color)!important}:host(.disabled:hover){background-color:var(--input-button-back-color)!important}`]}render(){return L``}static get properties(){return{shdw:{type:Boolean,reflect:!0}}}constructor(){super(),this.shdw=!1}firstUpdated(){for(;null!=this.firstChild;)this.renderRoot.appendChild(this.firstChild)}});customElements.define("input-checkbox",class extends it{static get styles(){return[n`:host{display:inline-flex;justify-content:center;align-items:center;position:relative;box-sizing:border-box;cursor:pointer;user-select:none;line-height:100%}label{padding:0 10px}`]}render(){return this.leftLabel?L`${this.label?L`<label>${this.label}</label>`:""}<input type="checkbox" ?disabled="${this.disabled}" ?checked="${this.checked}" @click="${this._handleClick}">`:L`<input type="checkbox" ?disabled="${this.disabled}" ?checked="${this.checked}" @click="${this._handleClick}">${this.label?L`<label>${this.label}</label>`:""}`}static get properties(){return{label:{type:String},checked:{type:Boolean,reflect:!0},disabled:{type:Boolean}}}constructor(){super(),this.checked=!1,this.label=null,this.leftLabel=!1,this.disabled=!1}_handleClick(t){this.checked=!this.checked,this.dispatchEvent(new CustomEvent("change",{detail:{checked:this.checked}}))}});
/**
 * @license
 * Copyright 2018 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Me=t=>null!=t?t:R
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,Pe=1,je=3,Ge=4;
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const He={},Ve=(t=>(...e)=>({_$litDirective$:t,values:e}))(class extends class{constructor(t){}T(t,e,i){this.Σdt=t,this.M=e,this.Σct=i}S(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}{constructor(t){if(super(t),t.type!==je&&t.type!==Pe&&t.type!==Ge)throw Error("The `live` directive is not allowed on child or event bindings");if(!(t=>void 0===t.strings)(t))throw Error("`live` bindings can only contain a single expression")}render(t){return t}update(t,[e]){if(e===F||e===R)return e;const i=t.element,s=t.name;if(t.type===je){if(e===i[s])return F}else if(t.type===Ge){if(!!e===i.hasAttribute(s))return F}else if(t.type===Pe&&i.getAttribute(s)===e+"")return F;return((t,e=He)=>{t.H=e;
/**
 * @license
 * Copyright 2020 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */})(t),e}});customElements.define("input-text",class extends it{static get styles(){return[n`:host{position:relative;display:inline-block;box-sizing:border-box;height:25px;width:100px;background-color:var(--input-text-back-color);border:1px solid var(--input-border-color);line-height:100%}input{background-color:inherit;font-size:inherit;font-family:inherit;display:block;box-sizing:border-box;margin:0;padding:1em;width:100%;height:100%;border:0;outline:transparent solid 0}input[type=number]{padding:0;text-align:center}input[type=number]::-webkit-textfield-decoration-container{height:100%}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:100%!important;opacity:1!important;border-radius:0!important}input[type=range]{-webkit-appearance:none;background:0 0}input[type=range]:disabled::-webkit-slider-thumb{background:var(--icon-disabled);border-color:#d6d6d6}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;border:1px solid #555;height:18px;width:8px;border-radius:0;background:#3e7bf0;cursor:pointer;margin-top:-8px}input[type=range]::-webkit-slider-runnable-track{width:100%;height:4px;cursor:pointer;background:#3e7bf0;border-radius:0;border:.2px solid #555}input[type=range]:focus::-webkit-slider-runnable-track{background:#367ebd}input[type=range]:disabled::-webkit-slider-runnable-track{background:var(--icon-disabled);border-color:#d6d6d6}input.suffix{padding-right:2em}input[type=range]{padding:0}span.suffix{position:absolute;top:25%;right:5px}`]}render(){return L`<input ?disabled="${this.disabled}" id="input" class="${Me(this.suffix?"suffix":void 0)}" @change="${this._handleInput}" step="${Me(this.step)}" min="${Me(this.min)}" max="${Me(this.max)}" type="${this.type}" placeholder="${this.placeholder}" .value="${Ve(this.value)}" ?readonly="${this.readonly}"> ${this.suffix?L`<span class="suffix">${this.suffix}</span>`:""}`}static get properties(){return{value:{type:String,reflect:!0,value:"",hasChanged:(t,e)=>!0},type:{type:String,reflect:!0},min:{type:Number},max:{type:Number},step:{type:Number},suffix:{type:String},disabled:{type:Boolean}}}constructor(){super(),this.value="",this.placeholder="",this.type="text",this.readonly=!1,this.min=void 0,this.max=void 0,this.suffix=null,this.disabled=!1}_handleInput(t){this.dispatchEvent(new CustomEvent("change",{detail:{value:t.target.value}}))}});customElements.define("input-color-picker",class extends it{static get styles(){return[n`:host{display:block;box-sizing:border-box;position:relative;margin:0}#colorinput{font-family:inherit;font-size:inherit;box-sizing:border-box;display:block;float:left;border:1px solid #ccc;padding:0 4px;margin:0;width:calc(100% - 21px);background-color:#fafafa;line-height:21px;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}#colorbox:focus,#colorinput:focus{outline:0}#colorinput:focus{border-color:#66afe9;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}#colorbox{box-sizing:border-box;float:left;cursor:pointer;padding:0;height:23px;width:21px;border:1px solid #bbb;border-right-width:0}#colorbox:focus+input+div#colorlist{visibility:visible;opacity:1}div#colorlist{box-sizing:border-box;position:fixed;z-index:1000000;visibility:hidden;opacity:0;padding:5px;width:298px;margin:0;top:0;left:0;border:1px solid #ccc;background:#fff;list-style:none;text-transform:none;transition:opacity .1s,visibility .1s;box-shadow:4px 4px 4px rgba(0,0,0,.2)}div#colorlist>div{box-sizing:border-box;display:block;float:left;width:15px;height:15px;margin:0;border:1px solid #fff;background-color:red}div#colorlist>div:hover{cursor:pointer;border:1px solid #000}`]}render(){return L`<div title="${this.ctitle}" tabindex="0" id="colorbox" @focus="${this.handleColorBoxClick}" style="${this.computeColorStyle(this.color)}"></div><input id="colorinput" type="${this.label?"text":"hidden"}" value="${this.color}" @keypress="${this.handleKeyPress}"> ${this.selectable?L`<div id="colorlist">${this.colors.map((t=>L`<div data-color="${t}" @mousedown="${this.handleColorClick}" style="${this.computeColorStyle(t)}"></div>`))}</div>`:""}`}static get properties(){return{preset:{type:String},colors:{type:Array},color:{type:String,reflect:!0},ctitle:{type:String},label:{type:Boolean},selectable:{type:Boolean}}}constructor(){super(),this.preset="default",this.colors=this.computeColors(),this.color="",this.ctitle="",this.label=!0,this.selectable=!0}firstUpdated(){this._updatePosition()}_updatePosition(){if(this.selectable){let o=this.renderRoot.querySelector("#colorlist");var t=this.getBoundingClientRect(),e=o.getBoundingClientRect(),i=e.width-(window.innerWidth-t.left),s=e.height-(window.innerHeight-t.bottom);o.style.left=i>0?t.left-e.width+20+"px":t.left+"px",o.style.top=s>0?t.top-e.height+"px":t.top+25+"px"}}handleColorClick(t){this.color=t.currentTarget.dataset.color,this.dispatchEvent(new CustomEvent("colorchange",{bubbles:!0,composed:!0,detail:{color:this.color}}))}handleKeyPress(t){13==t.keyCode&&(this.color=t.currentTarget.value,this.dispatchEvent(new CustomEvent("colorchange",{bubbles:!0,composed:!0,detail:{color:this.color}})))}handleColorBoxClick(t){this._updatePosition()}computeColorStyle(t){let e;return e=this.selectable?"background-color:"+t:"display: none",e}computeColors(t){return this._getColors()}_getColors(){return["#ffebee","#FCE4EC","#F3E5F5","#EDE7F6","#E8EAF6","#E3F2FD","#E1F5FE","#E0F7FA","#E0F2F1","#E8F5E9","#F1F8E9","#F9FBE7","#FFFDE7","#FFF8E1","#FFF3E0","#FBE9E7","#EFEBE9","#FAFAFA","#ECEFF1","#ffcdd2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#F5F5F5","#CFD8DC","#ef9a9a","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5","#e57373","#F06292","#BA68C8","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#FFF176","#FFD54F","#FFB74D","#FF8A65","#A1887F","#E0E0E0","#90A4AE","#ef5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C","#f44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B","#e53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A","#d32f2f","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64","#c62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F","#b71c1c","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238"]}_generateColors(t){var e=function(t,e,s){var o,n,a;if((t%=360)<0&&(t+=360),t=~~t/360,e<0?e=0:e>100&&(e=100),s<0?s=0:s>100&&(s=100),s=~~s/100,0===(e=~~e/100))o=n=a=s;else{var r=s<.5?s*(1+e):s+e-s*e,l=2*s-r;o=i(l,r,t+1/3),n=i(l,r,t),a=i(l,r,t-1/3)}return[~~(255*o),~~(255*n),~~(255*a)]},i=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},s=[],o={default:{saturation:[70,100,"rows"],hue:[0,300,"cols"],value:[40,98,"rows"]},warm:{saturation:[70,100,"rows"],hue:[0,60,"cols"],value:[40,98,"rows"]},cool:{saturation:[70,100,"rows"],hue:[150,280,"cols"],value:[40,98,"rows"]},moody:{saturation:[80,12,"rows"],hue:[0,300,"cols"],value:[30,70,"rows"]},primary:{saturation:[100,100,"rows"],hue:[0,300,"cols"],value:[50,98,"rows"]},pastel:{saturation:[50,90,"rows"],hue:[0,300,"cols"],value:[70,98,"rows"]}}[t];o.rows=6,o.cols=12;for(var n=function(t,e,i){var s=o[t][2],n="cols"==s?e:i,a=(o[t][1]-o[t][0])/o[s];return parseInt(n*a+o[t][0])},a=0;a<o.rows;a++)for(var r=0;r<o.cols;r++){var l=e(n("hue",r,a),n("saturation",r,a),n("value",r,a)),h=l[0].toString(16),c=l[1].toString(16),d=l[2].toString(16),p="#"+(1==h.length?"0":"")+h+(1==c.length?"0":"")+c+(1==d.length?"0":"")+d;s.push(p)}var u=o.cols,m=255/u;for(a=u;a>0;a--){var b=Math.ceil(a*m).toString(16);p="#"+(1==b.length?"0":"")+b+(1==b.length?"0":"")+b+(1==b.length?"0":"")+b;s.push(p)}return s}});const Ue={ADJUSTMENTS:{order:0,name:"Adjustments",visible:!0,FIELDSETS:{GENERAL_OPTIONS:{order:0,name:"General Options"}}}};class We extends it{static get styles(){return[n`:host *{box-sizing:border-box;position:relative}:host{display:block;position:absolute;top:0;right:0;width:var(--sidebar-width-expanded);height:100vh;pointer-events:none;display:flex;flex-flow:column;font-size:.95em;word-wrap:break-word;color:#555;font:12px sans-serif;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0;--text-color-disabled:#EBEBE4;--icon-disabled:#EBEBE4;--icon-disabled-hover-color:#EBEBE4;--input-width:92px}#toggle-sidebar{position:relative;flex:0 1 auto;pointer-events:auto;background-color:#fafbfc;box-shadow:0 2px 5px 0 rgba(0,0,0,.2);padding:5px;cursor:pointer}#contents-sidebar{position:relative;flex:1 1 auto;pointer-events:auto;background-color:#fafbfc;box-shadow:0 2px 5px 0 rgba(0,0,0,.2);overflow:auto;padding:5px 5px 5px 10px;border:1px solid #f0f0f0;border-top:0}#contents-sidebar.hidden_left,#toggle-sidebar.toggle_hidden_left{right:-285px;width:var(--sidebar-width-hidden);overflow:hidden;margin:0;padding:0}#toggle-sidebar.toggle_hidden_left{padding:5px 0}.hidden_top{visibility:hidden}.visible_top{visibility:visible}.hidden_left *{display:none}.visible_left *{visibility:visible}fieldset{border:0;padding:0;margin-bottom:15px}fieldset legend{font-size:12px;margin:5px 0;font-weight:700;margin-bottom:5px;margin-top:10px;cursor:pointer}fieldset.subsection{border:1px solid #d6d6d6;width:100%;padding:0 5px 5px 5px;margin-bottom:5px}.sidebar_control{display:flex;align-items:center;justify-content:space-between;padding:2px;margin:5px;flex-wrap:wrap}.control_subBlock{margin:0;padding:0}.blockVisible{display:block}.blockNotVisible{display:none}input-text[type=range]{border:0}.flex{display:flex}.jc-sb{justify-content:space-between}.ai-center{align-items:center}.inputWidth{width:var(--input-width)}.subBlockElement{margin-bottom:5px}select-down{height:23px}font-editor,input-color-picker,input-text{width:var(--input-width,100px)}`]}static get properties(){return{viewer:{type:Object},visible:{type:String},sections:{type:Object},modules:{type:Object}}}static getSidebarBlocks(){return Ue}constructor(t=null){super();const e=this.constructor.getSidebarBlocks();this.visible=!0,this.hideDirection="left",this.sections={},this.inverseBlocks=Object.assign({},...Object.keys(e).map((t=>({[e[t].name]:e[t].order})))),this.sections={},this.sidebarModulesEls={},this.modules=[],this.viewer=t,this.modulesVisible={}}_getIcon(){let t,e;return this.visible?(this.hideDirection,e="Hide Side Panel",t="top"==this.hideDirection?"angle-up":"angle-right"):(e="top"==this.hideDirection?"Show Side Panel":"",t="top"==this.hideDirection?"angle-down":"angle-left"),L`<fa-icon g="solid" n="${t}"></fa-icon>${e}`}_getBlockIcon(t){let e,i=t;return e=!(t in this.modulesVisible)||this.modulesVisible[t]?"angle-up":"angle-down",L`<fa-icon g="solid" n="${e}"></fa-icon>${i}`}_isBlockVisible(t){return!(t in this.modulesVisible)||this.modulesVisible[t]}connectedCallback(){super.connectedCallback(),window.addEventListener("resize",this._handleResize.bind(this))}disconnectedCallback(){window.removeEventListener("resize",this._handleResize.bind(this)),super.disconnectedCallback()}_handleResize(){this.style.minHeight=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)}firstUpdated(t){null!=this.viewer&&this.modules.length&&this.init()}init({viewer:t=null,modules:e=null}={}){null!=t&&(this.viewer=t),null!=e&&(this.modules=e),this.initializeModules();let i={};this.modules.map((t=>{let e=this.sidebarModulesEls[t];e&&(this.sections[e.block.name]||(this.sections[e.block.name]=[],this.modulesVisible[e.block.name]=e.block.visible),e.initCallback&&e.initCallback(),e.subBlock?(i[e.block.name]||(i[e.block.name]={}),i[e.block.name][e.subBlock.name]||(i[e.block.name][e.subBlock.name]=Object.assign({elements:[]},e.subBlock)),i[e.block.name][e.subBlock.name].elements.push(e)):this.sections[e.block.name].push(e))})),Object.keys(i).map((t=>{Object.keys(i[t]).map((e=>{let s=i[t][e];s.elements.sort(((t,e)=>(t.order||0)-(e.order||0)));let o={order:s.order,hasSubBlock:!0,element:()=>{let t=s.elements.map((t=>{const e=t.element();return e?L`<div class="subBlockElement">${e}</div>`:null})).filter(Boolean);return t.length?L`<fieldset class="subsection"><legend>${s.name}</legend>${t}</fieldset>`:null}};this.sections[t].push(o)}))})),Object.keys(this.sections).map((t=>{this.sections[t]=this.sections[t].sort(((t,e)=>(t.order||0)-(e.order||0))).map((t=>({isSubBlock:t.hasSubBlock,element:t.element})))})),console.log("SECTIONS",this.sections),this.requestUpdate()}render(){const t=Object.keys(this.sections).reduce(((t,e)=>{let i=this.sections[e].map((t=>{let e=t.element();return e?L`<div class="sidebar_control ${t.isSubBlock?"control_subBlock":""}">${e}</div>`:null})).filter(Boolean);return i.length&&(t[e]=i),t}),{});return L`<div id="toggle-sidebar" class="${this.visible?`toggle_visible_${this.hideDirection}`:`toggle_hidden_${this.hideDirection}`}" @click="${this.handleClickToggle}">${this._getIcon()}</div><div id="contents-sidebar" class="${this.visible?`visible_${this.hideDirection}`:`hidden_${this.hideDirection}`}">${Object.keys(t).sort(((t,e)=>this.inverseBlocks[t]-this.inverseBlocks[e])).map(((e,i)=>L`<fieldset><legend><span @click="${()=>this.handleSectionClickToggle(e,i)}">${this._getBlockIcon(e)}</span></legend><div id="block_contents_${i}" class="${this._isBlockVisible(e)?"blockVisible":"blockNotVisible"}">${t[e]}</div></fieldset>`))}</div>`}updated(t){console.log("UPDATED FROM WEB SIDEBAR MIXIN"),this._handleResize()}handleClickToggle(t){this.visible=!this.visible,this.dispatchEvent(new CustomEvent("change",{detail:{visible:this.visible}}))}handleSectionClickToggle(t){console.log(t),this.modulesVisible[t]=!this._isBlockVisible(t),this.requestUpdate()}addSection(t,e){this.sections[t]=e}addElement(t,e){t in this.sections&&(this.sections[t]=[]),this.sections[t].push(e)}initializeModules(){}registerSidebarElement(t,e){this.sidebarModulesEls[t]=e}deregisterSidebarElement(t){delete this.sidebarModulesEls[t]}}customElements.define("web-sidebar",We);customElements.define("theme-selector",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-around;align-items:center;width:100%}div{width:30px;height:30px;line-height:30px;color:transparent;box-sizing:border-box}div span{visibility:hidden;position:absolute;width:50px;transform:translateX(-10px);text-align:center;font-size:13px}div:hover span{color:#555;background-color:rgba(255,255,255,.4);font-weight:700;visibility:visible}.default{background:linear-gradient(135deg,#de7e7b 0,#c23531 50%,#2f4554 51%,#547b95 100%)}.light{background:linear-gradient(135deg,#8dcaea 0,#37a2da 50%,#ffd85c 51%,#fff0c2 100%)}.dark{background:linear-gradient(135deg,#f0bcb9 0,#dd6b66 50%,#759aa0 51%,#b1c6ca 100%)}`]}constructor(){super()}render(){return L`<div class="default" @click="${this.handleThemeClick}"><span>Default</span></div><div class="light" @click="${this.handleThemeClick}"><span>Light</span></div><div class="dark" @click="${this.handleThemeClick}"><span>Dark</span></div>`}handleThemeClick(t){this.dispatchEvent(new CustomEvent("change",{detail:{theme:t.path[1].getAttribute("class")||"default"}}))}});customElements.define("input-symbol-editor",class extends it{static get styles(){return[n`:host{display:inline-flex;justify-content:center;align-items:center;position:relative;box-sizing:border-box;cursor:pointer;user-select:none}div.input-button{display:inline-flex;justify-content:center;align-items:center;position:relative;box-sizing:border-box;cursor:pointer;user-select:none;background-color:var(--input-button-back-color);border:1px solid var(--input-border-color);height:23px;width:23px;line-height:100%;transition:background-color .15s;overflow:hidden}input-button{height:23px;width:23px;padding:0}#symbolbox:focus{outline:0}#symbolbox{box-sizing:border-box;float:left;cursor:pointer;padding:0}#symbolbox:focus+div#symbollist{display:block;opacity:1}div#symbollist{box-sizing:border-box;position:fixed;z-index:1000000;display:none;opacity:0;padding:5px;width:200px;margin:0;top:0;left:0;background:#fff;list-style:none;text-transform:none;transition:opacity .1s,visibility .1s;box-shadow:4px 4px 4px rgba(0,0,0,.2);padding:5px}div#symbollist>input-button{width:20px;height:20px}div#symbollist>div:first{box-sizing:border-box;display:flex;width:100%;margin:0;justify-content:space-around;align-items:center;flex-wrap:wrap}span.rect{width:16px;height:16px;background-color:#000}span.roundRect{width:16px;height:16px;background-color:#000;border-radius:35%}span.triangle{width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:16px solid #000}span.diamond{width:16px;height:16px;background-color:#000;transform:rotate(-45deg)}span.none{line-height:16px;width:16px;height:16px;text-align:center;margin:0 auto}span.unicode{width:16px;height:16px}span.unicodeTriangle:before{content:'△';width:16px;height:16px}span.text{font-size:23px;color:#000}span.arrow:before{content:'⮝'}`]}render(){return L`<div class="input-button" tabindex="0" id="symbolbox" @focus="${this.handleSymbolBoxClick}" @mousedown="${this.handleSymbolBoxClick}">${this.symbolTable[this.symbol].icon}</div>${this.selectable?L`<div id="symbollist"><div>${Object.keys(this.symbolTable).map((t=>L`<div class="input-button" @mousedown="${e=>this.handleSymbolClick(t)}">${this.symbolTable[t].icon}</div>`))}</div></div>`:""}`}static get properties(){return{symbol:{type:String,reflect:!0},symbolSize:{type:Number,reflect:!0},selectable:{type:Boolean}}}constructor(){super(),this.selectable=!0,this.symbolTable=this._getSymbols(),this.symbol=null,this.symbolSize=null}firstUpdated(){this._updatePosition()}_updatePosition(){if(this.selectable){let o=this.renderRoot.querySelector("#symbollist");var t=this.getBoundingClientRect(),e=o.getBoundingClientRect(),i=e.width-(window.innerWidth-t.left),s=e.height-(window.innerHeight-t.bottom);o.style.left=i>0?t.left-e.width+20+"px":t.left+"px",o.style.top=s>0?t.top-e.height+"px":t.top+25+"px"}}handleSymbolClick(t){this.symbol=t,this.dispatchEvent(new CustomEvent("symbolchange",{bubbles:!0,composed:!0,detail:{symbol:this.symbol}}))}handleSymbolBoxClick(t){this._updatePosition()}_getSymbols(){return{circle:{name:"Circle",icon:L`<span style="width:16px;height:16px;border-radius:50%;background-color:#000"></span>`},rect:{name:"Rect",icon:L`<span class="rect"></span>`},roundRect:{name:"Round Rect",icon:L`<span class="roundRect"></span>`},triangle:{name:"Triangle",icon:L`<span class="triangle"></span>`},diamond:{name:"Diamond",icon:L`<span class="diamond"></span>`},arrow:{name:"Arrow",icon:L`<span class="text arrow"></span>`},none:{name:"None",icon:L`<span class="text">--</span>`}}}});customElements.define("input-series",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-around;align-items:center;width:100%;--input-button-back-color:#fafafa;--input-border-color:black;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:black}input-button,input-symbol-editor{position:absolute;top:0;height:23px;visibility:hidden}input-checkbox{--icon-color:#000;--icon-hover-color:#000;font-size:23px;line-height:23px}#seriesinput{font-family:inherit;font-size:inherit;box-sizing:border-box;display:block;border:1px solid #ccc;padding:0 4px;margin:0;width:100%;background-color:#fafafa;line-height:21px;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}fieldset{border:0;margin:0;padding:0;display:inline;width:100%}fieldset:focus-within input-button,fieldset:focus-within input-symbol-editor{visibility:visible}fieldset:focus-within{border:2px red}`]}static get properties(){return{name:{type:String,reflect:!0},originalName:{type:String},enabled:{type:Boolean,reflect:!0},selectColor:{type:Boolean},color:{type:String},id:{type:Number},symbol:{type:String},symbolSize:{type:Number}}}set name(t){null===this.originalName&&t.length&&(this.originalName=t);let e=this._name;this._name=t,this.requestUpdate("name",e)}get name(){return this._name}constructor(){super(),this._name="Series name",this.originalName=null,this.id=0,this.enabled=!0,this.color="",this.selectColor=!0,this.symbol=null,this.symbolSize=null}render(){return L`<input-checkbox ?checked="${this.enabled}" label="" @change="${this.handleCheckbox}"></input-checkbox><input-color-picker color="${this.color}" @colorchange="${this.handleColorChange}" .label="${!1}" .selectable="${this.selectColor}"></input-color-picker><fieldset><input id="seriesinput" type="text" value="${this.name}" @input="${this.handleInputChange}" @blur="${this.handleInputBlur}"> ${this.symbol?L`<input-symbol-editor .symbol="${this.symbol}" .symbolSize="${this.symbolSize}" @symbolchange="${this.handleSymbolChange}" @sizechange="${this.handleSymbolSizeChange}" style="right:48px"></input-symbol-editor>`:""}<input-button @mousedown="${this.handleSaveClick}" style="right:23px"><fa-icon g="solid" n="check"></fa-icon></input-button><input-button @mousedown="${this.handleCancelClick}" style="right:0"><fa-icon g="solid" n="times"></fa-icon></input-button></fieldset>`}handleSymbolChange(t){this.symbol=t.detail.symbol,this.dispatchEvent(new CustomEvent("symbolchange",{detail:{property:"symbol",value:this.symbol,id:this.id}}))}handleSymbolSizeChange(t){this.symbolSize=t.detail.size,this.dispatchEvent(new CustomEvent("symbolchange",{detail:{property:"symbolSize",value:this.symbolSize,id:this.id}}))}handleColorChange(t){this.color=t.detail.color,this.dispatchEvent(new CustomEvent("colorchange",{detail:{color:this.color,id:this.id}}))}handleCheckbox(t){this.enabled=t.detail.checked,this.dispatchEvent(new CustomEvent("toggle",{detail:{enabled:this.enabled,id:this.id}}))}handleCancelClick(t){this.dispatchEvent(new CustomEvent("cancel",{detail:{name:this.name,id:this.id}}))}handleSaveClick(t){this.originalName=this.name,this.dispatchEvent(new CustomEvent("change",{detail:{name:this.name,id:this.id}}))}handleInputBlur(t){this.name=this.originalName,t.target.value=this.originalName}handleInputChange(t){this.name=t.target.value}});customElements.define("input-formatting",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-between;align-items:center;width:100%;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0}span{flex:1 0 20%}input-text{width:40px}`]}static get properties(){return{label:{type:String,reflect:!0},options:{type:Object},disabled:{type:Boolean}}}constructor(){super(),this.label="",this.options={},this.disabled=!1}render(){return L`<label>${this.label}</label> <span></span><input-button class="${this.disabled?"disabled":""}" @click="${this.handleBoldClick}"><fa-icon .enabled="${!this.disabled}" g="solid" n="bold" ?selected="${"bold"==this.options.fontWeight}"></fa-icon></input-button><input-button class="${this.disabled?"disabled":""}" @click="${this.handleStyleClick}"><fa-icon .enabled="${!this.disabled}" g="solid" n="italic" ?selected="${"italic"==this.options.fontStyle}"></fa-icon></input-button><input-text .disabled="${this.disabled}" type="number" @change="${this.handleInputChange}" value="${this.options.fontSize}" min="10" max="100"></input-text>`}handleSaveClick(t){}handleInputChange(t){this.options.fontSize=t.detail.value,this.dispatchEvent(new CustomEvent("change",{detail:{options:this.options,property:"fontSize"}}))}handleBoldClick(t){this.options.fontWeight="bold"==(this.options.fontWeight||"normal")?"normal":"bold",this.requestUpdate(),this.dispatchEvent(new CustomEvent("change",{detail:{options:this.options,property:"fontWeight"}}))}handleStyleClick(t){this.options.fontStyle="italic"==(this.options.fontStyle||"normal")?"normal":"italic",this.requestUpdate(),this.dispatchEvent(new CustomEvent("change",{detail:{options:this.options,property:"fontStyle"}}))}});customElements.define("series-editor",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc}`]}static get properties(){return{label:{type:String,reflect:!0},chartData:{type:Array},originalData:{type:Array},selectColor:{type:Boolean}}}set chartData(t){let e=this._chartData;this._chartData=t,this.requestUpdate("chartData",e)}get chartData(){return this._chartData}constructor(){super(),this._chartData=[],this.originalData=[],this.selectColor=!0,this.aliases={},this.chartData=[]}render(){return L`${this.originalData.filter((t=>!t._obEditable)).map(this._renderInput.bind(this))}`}_renderInput(t,e){let i=this._getValue(t.data),s=this._getColor(t.data),o=this.aliases[i]||i,n=t.enabled,a=this._getSymbol(t.data),r=this._getSymbolSize(t.data);return L`<input-series name="${o}" color="${s}" .selectColor="${this.selectColor}" .id="${e}" .symbol="${a}" .symbolSize="${r}" .enabled="${n}" @toggle="${this.handleToggle}" @change="${this.handleChange}" @colorchange="${this.handleColorChange}" @symbolchange="${this.handleSymbolChange}"></input-series>`}_getValue(t){return t.value?t.value:t.name?t.name:t}_getColor(t){return t.color?t.color:t.itemStyle?t.itemStyle.color:null}_getSymbol(t){return!1!==t.showSymbol?t.symbol:null}_getSymbolSize(t){return t.symbolSize}handleChange(t){let e=this._getValue(this.originalData[t.detail.id].data);this.aliases[e]=t.detail.name,this.dispatchEvent(new CustomEvent("change",{detail:{type:"change",detail:t.detail,chartData:this.chartData}}))}handleSymbolChange(t){t.detail.id in this.chartData&&("string"==typeof this.chartData[t.detail.id]&&this.chartData[t.detail.id]instanceof String||(this.chartData[t.detail.id][t.detail.property]=t.detail.value),this.dispatchEvent(new CustomEvent("change",{detail:{type:"symbol",detail:t.detail,chartData:this.chartData}})))}handleColorChange(t){t.detail.id in this.chartData&&("string"==typeof this.chartData[t.detail.id]&&this.chartData[t.detail.id]instanceof String||(this.chartData[t.detail.id].itemStyle||(this.chartData[t.detail.id].itemStyle={}),"line"==this.chartData[t.detail.id].type&&(this.chartData[t.detail.id].lineStyle||(this.chartData[t.detail.id].lineStyle={}),this.chartData[t.detail.id].lineStyle.color=t.detail.color,this.chartData[t.detail.id].areaStyle&&(this.chartData[t.detail.id].areaStyle.color=t.detail.color)),this.chartData[t.detail.id].itemStyle.color=t.detail.color,"borderColor"in this.chartData[t.detail.id].itemStyle&&!this.chartData[t.detail.id]._obCustomBorderColor&&(this.chartData[t.detail.id].itemStyle.borderColor=t.detail.color)),this.dispatchEvent(new CustomEvent("change",{detail:{type:"color",detail:t.detail,chartData:this.chartData}})))}handleToggle(t){t.detail.enabled?this._chartData.splice(t.detail.id,0,this.originalData[t.detail.id].data):this._chartData.splice(this._chartData.indexOf(this.originalData[t.detail.id].data),1),this.originalData[t.detail.id].enabled=t.detail.enabled,this.dispatchEvent(new CustomEvent("change",{detail:{type:"toggle",detail:t.detail,chartData:this.chartData}}))}});customElements.define("plot-type-editor",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-evenly;align-items:center;width:100%;flex-wrap:wrap;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0}input-button{font-size:25px;line-height:25px;width:1.5em;height:1.5em;padding:0}`]}static get properties(){return{current:{type:String,reflect:!0},options:{type:Array}}}constructor(){super(),this.current="bar",this.options=[],this.validTypes=["bar","horizontal-bar","line","area","pie"],this.viewer=null}render(){return null!=this.viewer&&(this.current=`${this.viewer._getOrientation()==$t?"":"horizontal-"}${this.viewer.options.series[0].type||"bar"}`,"line"==this.current&&this.viewer.options.series[0].areaStyle&&1==this.viewer.options.series[0].areaStyle.opacity&&(this.current="area")),L`${this.validTypes.includes("bar")?L`<input-button @click="${t=>this.handleClickButton("bar")}"><fa-icon g="solid" n="chart-bar" ?selected="${"bar"==this.current}"></fa-icon></input-button>`:""} ${this.validTypes.includes("horizontal-bar")?L`<input-button @click="${t=>this.handleClickButton("horizontal-bar","bar",!0)}"><fa-icon style="transform:scaleX(-1) rotate(-90deg)" g="solid" n="chart-bar" ?selected="${"horizontal-bar"==this.current}"></fa-icon></input-button>`:""} ${this.validTypes.includes("line")?L`<input-button @click="${t=>this.handleClickButton("line")}"><fa-icon g="solid" n="chart-line" ?selected="${"line"==this.current}"></fa-icon></input-button>`:""} ${this.validTypes.includes("area")?L`<input-button @click="${t=>this.handleClickButton("area","line",!1,!0)}"><fa-icon g="solid" n="chart-area" ?selected="${"area"==this.current}"></fa-icon></input-button>`:""} ${this.validTypes.includes("pie")?L`<input-button @click="${t=>this.handleClickButton("pie")}"><fa-icon g="solid" n="chart-pie" ?selected="${"pie"==this.current}"></fa-icon></input-button>`:""}`}handleClickButton(t,e=t,i=!1,s=!1){t!=this.current&&(this.current=t,this.dispatchEvent(new CustomEvent("change",{detail:{type:t,plotType:e,xAxisType:i?"value":"category",yAxisType:i?"category":"value",fill:s,isHorizontal:i}})))}});customElements.define("grid-editor",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0}span{flex:1 0 20%}span.input-formatting{flex:0 0 92px;display:inline-flex;justify-content:space-between}`]}static get properties(){return{current:{type:String,reflect:!0},options:{type:Array},is3dChart:{type:Boolean}}}constructor(){super(),this.is3dChart=!1,this.options={xAxis:{splitLine:{show:!1,lineStyle:{type:"solid"}}},yAxis:{splitLine:{show:!1,lineStyle:{type:"solid"}}},xAxis3D:{splitLine:{show:!1,lineStyle:{type:"solid"}}},yAxis3D:{splitLine:{show:!1,lineStyle:{type:"solid"}}},zAxis3D:{splitLine:{show:!1,lineStyle:{type:"solid"}}}}}_getAxisName(t){return`${t}${this.is3dChart?"3D":""}`}_getOption(t){return this.options[`${t}${this.is3dChart?"3D":""}`]}render(){return L`<label>Grid options</label> <span></span> <span class="input-formatting"><input-button @click="${t=>this.handleClickToggleButton("xAxis")}"><fa-icon style="transform:scaleX(-1) rotate(-90deg)" g="solid" n="bars" ?selected="${this._getOption("xAxis")[0].splitLine.show}"></fa-icon></input-button><input-button @click="${t=>this.handleClickToggleButton("yAxis")}"><fa-icon g="solid" n="bars" ?selected="${this._getOption("yAxis")[0].splitLine.show}"></fa-icon></input-button><input-button @click="${t=>this.handleClickStyleButton()}"><fa-icon g="solid" n="border-none" ?selected="${"dashed"==this._getOption("xAxis")[0].splitLine.lineStyle.type}"></fa-icon></input-button></span>`}handleClickToggleButton(t){let e=this._getAxisName(t);this.options[e][0].splitLine.show=!this.options[e][0].splitLine.show,this.dispatchEvent(new CustomEvent("change",{detail:{axis:[e],state:this.options[e][0].splitLine.show}})),this.requestUpdate()}handleClickStyleButton(){let t=this._getAxisName("xAxis"),e=this._getAxisName("yAxis");this.options[t][0].splitLine.lineStyle.type="solid"==this.options[t][0].splitLine.lineStyle.type?"dashed":"solid",this.options[e][0].splitLine.lineStyle.type="solid"==this.options[e][0].splitLine.lineStyle.type?"dashed":"solid",this.dispatchEvent(new CustomEvent("change",{detail:{axis:[t,e],state:this.options[t][0].splitLine.lineStyle.type}})),this.requestUpdate()}});customElements.define("tilting-editor",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0}span{flex:1 0 20%}span.input-formatting{flex:0 0 92px;display:inline-flex;justify-content:space-between}`]}static get properties(){return{label:{type:String,reflect:!0},options:{type:Object},disabled:{type:Boolean}}}constructor(){super(),this.disabled=!1,this.options=[{axisLabel:{}}],this.label="",this.posTransformations={left:1,right:-1,top:1,bottom:1}}render(){let t=Math.abs(this.options[0].axisLabel.rotate);return L`<label>${this.label}</label> <span></span> <span class="input-formatting"><input-button class="${this.disabled?"disabled":""}" @click="${t=>this.handleClickButton(0)}"><fa-icon .enabled="${!this.disabled}" g="solid" n="grip-lines" ?selected="${0==t}"></fa-icon></input-button><input-button class="${this.disabled?"disabled":""}" @click="${t=>this.handleClickButton(45)}"><fa-icon .enabled="${!this.disabled}" style="transform:scaleX(-1) rotate(45deg)" g="solid" n="grip-lines" ?selected="${45==t}"></fa-icon></input-button><input-button class="${this.disabled?"disabled":""}" @click="${t=>this.handleClickButton(90)}"><fa-icon .enabled="${!this.disabled}" style="transform:scaleX(-1) rotate(90deg)" g="solid" n="grip-lines" ?selected="${90==t}"></fa-icon></input-button></span>`}handleClickButton(t){let e=Math.abs(this.options[0].axisLabel.rotate);t!=e&&(this.options.map((e=>{e.axisLabel.rotate=t*this.posTransformations[e.position]})),this.requestUpdate(),this.dispatchEvent(new CustomEvent("change",{detail:{options:this.options,property:"rotate"}})))}});customElements.define("label-limit-editor",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0}div{display:flex;width:100%;align-items:center}div+div{margin-top:5px}span{flex:1 0 20%}input-text{width:65px}`]}static get properties(){return{label:{type:String,reflect:!0},axis:{type:Array},limitValue:{type:Array,hasChanged:(t,e)=>!0},scientificMode:{type:Array},disabled:{type:Boolean}}}constructor(){super(),this.label="Label char limit",this.axis=[],this.limitValue=[],this.scientificMode=[],this.disabled=!1}_getAxisLabel(t){let e=this.axis.length>1?` (${this.axis[t].position})`:"";return`${"category"==this.axis[t].type?"Char limit":this.scientificMode[t]?"Significant digits":"Max dec. digits"}${e}`}_getAxisMax(t){return"category"==this.axis[t].type?200:10}render(){return this.axis.map(((t,e)=>!1===t.axisLabel.show?"":L`<div><label>${this._getAxisLabel(e)}</label> <span></span><input-button @click="${t=>this.handleClickButton(e)}" class="${this.disabled||"category"==t.type?"disabled":""}"><fa-icon .enabled="${!this.disabled&&"category"!=t.type}" g="misc" n="scientific-notation" ?selected="${this.scientificMode[e]}"></fa-icon></input-button><input-text .index="${e}" .disabled="${this.disabled}" @change="${t=>this.handleInputChange(e,t)}" .value="${this.limitValue[e]}" type="number" min="0" step="1" max="${this._getAxisMax(e)}"></input-text></div>`))}handleClickButton(t){this.disabled||"category"==this.axis[t].type||(this.scientificMode[t]=!this.scientificMode[t],this.requestUpdate(),this.dispatchEvent(new CustomEvent("change",{detail:{index:t,value:this.scientificMode[t],attribute:"mode"}})))}handleInputChange(t,e){this.limitValue[t]=Math.min(e.detail.value,this._getAxisMax(t)),e.currentTarget.value=this.limitValue[t],this.requestUpdate(),this.dispatchEvent(new CustomEvent("change",{detail:{index:t,value:this.limitValue[t],attribute:"limit"}}))}});customElements.define("axis-interval-editor",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-between;align-items:center;width:100%;flex-wrap:wrap;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0}div{display:flex;width:100%;align-items:center}div+div{margin-top:5px}span{flex:1 0 20%}input-text{width:65px}.inputWidth{width:var(--input-width)}`]}static get properties(){return{label:{type:String,reflect:!0},axis:{type:Array,hasChanged:(t,e)=>!0},disabled:{type:Boolean}}}constructor(){super(),this.maxValue=100,this.label="Label interval",this.axis=[],this.disabled=!1,this.customAliases=!1,this.categoryOptions={"Show all":0,Adaptative:null}}_getAxisLabel(t){let e=this.axis.length>1?` (${this.axis[t].position})`:"";return`${this.label}${e}`}_getSelectedCategory(t){return Object.keys(this.categoryOptions).find((e=>("interval"in this.axis[t].axisLabel?this.axis[t].axisLabel.interval:0)==this.categoryOptions[e]))}render(){return this.axis.map(((t,e)=>!1===t.axisLabel.show?"":L`<div><label>${this._getAxisLabel(e)}</label> <span></span> ${"category"==t.type?L`<select-down class="inputWidth" .options="${Object.keys(this.categoryOptions)}" .selectedOption="${{title:this._getSelectedCategory(e)}}" .enabled="${!this.disabled}" @select="${t=>this.handleSelectChange(e,t)}"></select-down>`:L`<input-text class="inputWidth" .disabled="${this.disabled||this.customAliases}" @change="${t=>this.handleInputChange(e,t)}" value="${t.splitNumber}" type="range" min="1" step="1" max="${Me(this.maxValue||100)}" title="This is a reference number, the final number of intervals will be adjusted based on readability."></input-text>`}</div>`))}handleSelectChange(t,e){"axisLabel"in this.axis[t]?(console.log("AXIS CHANGE",e),this.axis[t].axisLabel.interval!=this.categoryOptions[e.detail]&&(this.axis[t].axisLabel.interval=this.categoryOptions[e.detail],this.dispatchEvent(new CustomEvent("change",{detail:{index:t,value:this.axis[t].interval,attribute:"interval"}})))):console.log("NO AXIS LABEL: fix this")}handleInputChange(t,e){this.axis[t].splitNumber=e.detail.value,this.dispatchEvent(new CustomEvent("change",{detail:{index:t,value:this.axis[t].splitNumber,attribute:"splitNumber"}}))}});customElements.define("font-editor",class extends it{static get styles(){return[n`:host{display:flex;position:relative;box-sizing:border-box;cursor:pointer;justify-content:space-between;align-items:center;width:100%;--input-button-back-color:#fafafa;--input-border-color:#ccc;--input-button-back-hover-color:#ffffff;--input-button-back-active-color:#ccc;--icon-selected:#3e7bf0;--icon-selected-hover-color:#3e7bf0}select-down{height:23px;outline:1px solid var(--input-border-color);width:100%}`]}render(){return L`<select-down .options="${this.availableFonts}" @select="${t=>{this.handleFontFamilyChange(t)}}" .selectedOption="${this._getSelectedOption()}"></select-down>`}static get properties(){return{label:{type:String,reflect:!0},selectedFont:{type:Object}}}constructor(){super(),this.label="",this.availableFonts=[{name:"'Arial'",title:L`<span style="font-family:Arial">Arial</span>`},{name:"'Roboto'",title:L`<span style="font-family:Roboto">Roboto</span>`},{name:"'Roboto Mono'",title:L`<span style="font-family:'Roboto Mono'">Roboto Mono</span>`},{name:"'Noto Sans'",title:L`<span style="font-family:'Noto Sans'">Noto Sans</span>`}],this.selectedFont=this.availableFonts[0]}_getSelectedOption(){return utils.isString(this.selectedFont)?this.availableFonts.find((t=>t.name==this.selectedFont)):this.selectedFont}handleFontFamilyChange(t){this.dispatchEvent(new CustomEvent("change",{detail:{value:t.detail.name}}))}});const qe={ABSOLUTE_VALUE:{name:"absolute_value",title:"Absolute value"},ENTRY:le.ENTRY},Xe={LOWER:{name:"lower",title:"Lower Than"},HIGHER:{name:"higher",title:"Higher Than"}};class Ze extends(De(We).with(Ie)){constructor(t,e){super(t),this.viewer=t,this.modules=e}static getSidebarBlocks(){return re}init({viewer:t=null,modules:e=null}={}){let i={viewer:t,modules:e};if(null!=t&&null!=e){let t=e.slice();t.includes(Ft)&&!t.includes(ie)&&t.push(ie),i.modules=t}super.init(i)}initializeModules(){super.initializeModules();const t={[te]:{block:re.FONT_SETTINGS,element:()=>L`<div class="flex jc-sb ai-center" style="width:100%"><label>Font family</label><font-editor .selectedFont="${this.viewer.params.omicsBox.fontFamily}" @change="${t=>this.viewer._updateFontFamilyOptions(t)}"></font-editor></div>`,order:0,subBlock:re.FONT_SETTINGS.FIELDSETS.GENERAL_OPTIONS},[Bt]:{block:re.FONT_SETTINGS,element:()=>L`<input-formatting label="Title" .options="${this.viewer.options.title.textStyle}" @change="${t=>this.handleFormattingChange(t,"title","textStyle")}"></input-formatting>`,order:1,subBlock:re.FONT_SETTINGS.FIELDSETS.GENERAL_OPTIONS},[jt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasXAxis()&&this.viewer.hasYAxis()?L`<grid-editor .is3dChart="${this.viewer.is3DChart()}" .originalData="${null}" .options="${this.viewer.options}" @change="${t=>t.detail.axis.map((t=>this.viewer._updateAxisGridOptions(t)))}"></grid-editor>`:null,order:2,subBlock:re.FONT_SETTINGS.FIELDSETS.GENERAL_OPTIONS},[ee]:{block:re.FONT_SETTINGS,element:()=>L`<div class="flex jc-sb ai-center" style="width:100%"><label>Symbol size</label><input-text class="updateAfterPlotChange inputWidth" .disabled="${!this.viewer.hasSymbols()}" @change="${t=>{this.handleSymbolSizeChange(t)}}" value="${this.viewer.getSymbolSize()}" type="range" min="1" max="50" step="1"></input-text></div>`,order:3,subBlock:re.FONT_SETTINGS.FIELDSETS.GENERAL_OPTIONS},[Qt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasZoomSliderAvailable()?L`<div class="flex jc-sb ai-center" style="width:100%"><label>Enable zoom sliders</label><input-checkbox class="updateAfterPlotChange" .disabled="${this.viewer.options.series.some((t=>"pie"==t.type))}" .checked="${this.viewer.params.omicsBox.enableZoomSlider}" @change="${t=>{this.handleZoomCheckboxChange(t)}}" style="background-color:none" label=""></input-checkbox></div>`:null,order:4,subBlock:re.FONT_SETTINGS.FIELDSETS.GENERAL_OPTIONS},[Ut]:{block:re.FONT_SETTINGS,element:()=>L`<div class="flex jc-sb ai-center" style="width:100%"><label>Enable floating labels</label><input-checkbox .checked="${this.viewer.params.omicsBox.enableLabels}" @change="${t=>{this.handleLabelCheckboxChange(t)}}" style="background-color:none" label=""></input-checkbox></div>`,order:5,subBlock:re.FONT_SETTINGS.FIELDSETS.GENERAL_OPTIONS},[ie]:{block:re.FONT_SETTINGS,element:()=>L`<input-formatting .disabled="${this.viewer.hasVisibleAxis()}" label="Pie Chart Labels" .options="${this.viewer.options.series[0].label}" @change="${t=>this.viewer._updateOptions("series")}"></input-formatting>`,order:1,subBlock:re.FONT_SETTINGS.FIELDSETS.GENERAL_OPTIONS},[Nt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasXAxis()?this.viewer.options[this.viewer.getAxisOption("xAxis")].map(((t,e,i)=>L`<input-formatting .disabled="${!this.viewer.hasVisibleAxis()}" label="Title${i.length>1?` (${e})`:""}" .options="${t.nameTextStyle}" @change="${t=>this.handleFormattingChange(t,this.viewer.getAxisOption("xAxis"),"nameTextStyle",e)}"></input-formatting>`)):null,order:0,subBlock:re.FONT_SETTINGS.FIELDSETS.XAXIS_OPTIONS},[Ft]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasXAxis()?this.viewer.options[this.viewer.getAxisOption("xAxis")].map(((t,e,i)=>L`<input-formatting .disabled="${!this.viewer.hasVisibleAxis()}" label="Labels${i.length>1?` (${e})`:""}" .options="${t.axisLabel}" @change="${t=>this.handleFormattingChange(t,this.viewer.getAxisOption("xAxis"),"axisLabel",e)}"></input-formatting>`)):null,order:1,subBlock:re.FONT_SETTINGS.FIELDSETS.XAXIS_OPTIONS},[Xt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.getUniqueGridsNumber()>1||!this.viewer.hasXAxis()||this.viewer.is3DChart()?null:L`<tilting-editor .disabled="${!this.viewer.hasVisibleAxis()}" label="Rotation" .options="${this.viewer.options[this.viewer.getAxisOption("xAxis")]}" @change="${t=>this.viewer._updateOptions(this.viewer.getAxisOption("xAxis"))}"></tilting-editor>`,order:5,subBlock:re.FONT_SETTINGS.FIELDSETS.XAXIS_OPTIONS},[Jt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasXAxis()?L`<label-limit-editor .disabled="${!this.viewer.hasVisibleAxis()}" @change="${t=>this.viewer._updateOptions(this.viewer.getAxisOption("xAxis"))}" .axis="${this.viewer.options[this.viewer.getAxisOption("xAxis")]}" .limitValue="${this.viewer.params.omicsBox.labelTruncating.x}" .scientificMode="${this.viewer.params.omicsBox.labelScientificMode.x}"></label-limit-editor>`:null,order:3,subBlock:re.FONT_SETTINGS.FIELDSETS.XAXIS_OPTIONS},[Wt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasXAxis()?L`<axis-interval-editor .customAliases="${this.viewer.hasXTicksAliases()}" .disabled="${!this.viewer.hasVisibleAxis()}" @change="${t=>{this.handleAxisInterval(this.viewer.getAxisOption("xAxis"),t)}}" .axis="${this.viewer.options[this.viewer.getAxisOption("xAxis")]}"></axis-interval-editor>`:null,order:4,subBlock:re.FONT_SETTINGS.FIELDSETS.XAXIS_OPTIONS},[It]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasYAxis()?this.viewer.options[this.viewer.getAxisOption("yAxis")].map(((t,e,i)=>L`<input-formatting .disabled="${!this.viewer.hasVisibleAxis()}" label="Title${i.length>1?` (${e})`:""}" .options="${t.nameTextStyle}" @change="${t=>this.handleFormattingChange(t,this.viewer.getAxisOption("yAxis"),"nameTextStyle",e)}"></input-formatting>`)):null,order:0,subBlock:re.FONT_SETTINGS.FIELDSETS.YAXIS_OPTIONS},[Lt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasYAxis()?this.viewer.options[this.viewer.getAxisOption("yAxis")].map(((t,e,i)=>L`<input-formatting .disabled="${!this.viewer.hasVisibleAxis()}" label="Labels${i.length>1?` (${e})`:""}" .options="${t.axisLabel}" @change="${t=>this.handleFormattingChange(t,this.viewer.getAxisOption("yAxis"),"axisLabel",e)}"></input-formatting>`)):null,order:1,subBlock:re.FONT_SETTINGS.FIELDSETS.YAXIS_OPTIONS},[Zt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.getUniqueGridsNumber()>1||!this.viewer.hasYAxis()||this.viewer.is3DChart()?null:L`<tilting-editor .disabled="${!this.viewer.hasVisibleAxis()}" label="Rotation" .options="${this.viewer.options[this.viewer.getAxisOption("yAxis")]}" @change="${t=>this.viewer._updateOptions(this.viewer.getAxisOption("yAxis"))}"></tilting-editor>`,order:5,subBlock:re.FONT_SETTINGS.FIELDSETS.YAXIS_OPTIONS},[Yt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasYAxis()?L`<label-limit-editor .disabled="${!this.viewer.hasVisibleAxis()}" @change="${t=>this.viewer._updateOptions(this.viewer.getAxisOption("yAxis"))}" .axis="${this.viewer.options[this.viewer.getAxisOption("yAxis")]}" .limitValue="${this.viewer.params.omicsBox.labelTruncating.y}" .scientificMode="${this.viewer.params.omicsBox.labelScientificMode.y}"></label-limit-editor>`:null,order:3,subBlock:re.FONT_SETTINGS.FIELDSETS.YAXIS_OPTIONS},[qt]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasYAxis()?L`<axis-interval-editor .customAliases="${this.viewer.hasYTicksAliases()}" .disabled="${!this.viewer.hasVisibleAxis()}" @change="${t=>{this.handleAxisInterval(this.viewer.getAxisOption("yAxis"),t)}}" .axis="${this.viewer.options[this.viewer.getAxisOption("yAxis")]}"></axis-interval-editor>`:null,order:4,subBlock:re.FONT_SETTINGS.FIELDSETS.YAXIS_OPTIONS},[se]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasZAxis()?this.viewer.options[this.viewer.getAxisOption("zAxis")].map(((t,e,i)=>L`<input-formatting .disabled="${!this.viewer.hasVisibleAxis()}" label="Title${i.length>1?` (${e})`:""}" .options="${t.nameTextStyle}" @change="${t=>this.handleFormattingChange(t,this.viewer.getAxisOption("zAxis"),"nameTextStyle",e)}"></input-formatting>`)):null,order:0,subBlock:re.FONT_SETTINGS.FIELDSETS.ZAXIS_OPTIONS},[oe]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasZAxis()?this.viewer.options[this.viewer.getAxisOption("zAxis")].map(((t,e,i)=>L`<input-formatting .disabled="${!this.viewer.hasVisibleAxis()}" label="Labels${i.length>1?` (${e})`:""}" .options="${t.axisLabel}" @change="${t=>this.handleFormattingChange(t,this.viewer.getAxisOption("zAxis"),"axisLabel",e)}"></input-formatting>`)):null,order:1,subBlock:re.FONT_SETTINGS.FIELDSETS.ZAXIS_OPTIONS},[ae]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasZAxis()?L`<label-limit-editor .disabled="${!this.viewer.hasVisibleAxis()}" @change="${t=>this.viewer._updateOptions(this.viewer.getAxisOption("zAxis"))}" .axis="${this.viewer.options[this.viewer.getAxisOption("zAxis")]}" .limitValue="${this.viewer.params.omicsBox.labelTruncating.z}" .scientificMode="${this.viewer.params.omicsBox.labelScientificMode.z}"></label-limit-editor>`:null,order:3,subBlock:re.FONT_SETTINGS.FIELDSETS.ZAXIS_OPTIONS},[ne]:{block:re.FONT_SETTINGS,element:()=>this.viewer.hasZAxis()?L`<axis-interval-editor .customAliases="${this.viewer.hasZTicksAliases()}" .disabled="${!this.viewer.hasVisibleAxis()}" @change="${t=>{this.handleAxisInterval(this.viewer.getAxisOption("zAxis"),t)}}" .axis="${this.viewer.options[this.viewer.getAxisOption("zAxis")]}"></axis-interval-editor>`:null,order:4,subBlock:re.FONT_SETTINGS.FIELDSETS.ZAXIS_OPTIONS},[Rt]:{block:re.PLOT,element:()=>this._getValidPlotTypes().length>1?L`<plot-type-editor .viewer="${this.viewer}" @change="${t=>this.handlePlotType(t)}" .validTypes="${this._getValidPlotTypes()}"></plot-type-editor>`:null},[zt]:{block:re.SERIES,element:()=>L`<series-editor .originalData="${this.viewer.params.omicsBox.seriesInfo}" .chartData="${this.viewer.options.series}" .aliases="${this.viewer._getAliases("series")}" .selectColor="${!0}" .selectSymbol="${!0}" @change="${t=>{this.viewer._updateOptions(this.viewer.options,!0),this.viewer.updateSeriesCallbacks()}}"></series-editor>`},[Mt]:{block:re.ADJUSTMENTS,element:()=>this.viewer.hasSortingAllowed()?L`<div class="flex jc-sb ai-center" style="width:100%;margin-bottom:5px"><label>Enable sorting</label><input-checkbox .checked="${this.viewer.params.omicsBox.enableSorting}" @change="${t=>{this.handleSortingCheckboxChange(t)}}" style="background-color:none" label=""></input-checkbox></div><div class="flex jc-sb ai-center" style="width:100%"><label>Sort by</label><select-down class="inputWidth" id="_sb_sorting_options" .enabled="${this.viewer.params.omicsBox.enableSorting}" .options="${Object.values(this._getSortingOptions())}" @select="${t=>{this.handleSelectSortingChange(t)}}" .selectedOption="${this._getSelectionByName(this._getSortingOptions(),this.viewer.params.omicsBox.sortingOption)}"></select-down></div>`:null,initCallback:()=>{},order:1,subBlock:re.ADJUSTMENTS.FIELDSETS.SORTING_OPTIONS},[Pt]:{block:re.ADJUSTMENTS,element:()=>this.viewer.params.omicsBox.enableLimit?L`<div class="flex jc-sb ai-center" style="width:100%;margin-bottom:5px"><label>Filter method:</label><select-down class="inputWidth" style="width:140px" id="_sb_limit_options" .enabled="${this.viewer.params.omicsBox.enableLimit}" .options="${this._getLimitOptions()}" @select="${t=>{this.handleSelectLimitChange(t)}}" .selectedOption="${this._getLimitSelection()}"></select-down></div><div class="flex jc-sb ai-center" style="width:100%;margin-bottom:5px"><label>Show only:</label><select-down class="inputWidth" style="width:140px" .enabled="${this.viewer.params.omicsBox.enableLimit&&this._hasValueLimitAvailable()}" .options="${this._getValueLimitOptions()}" @select="${t=>{this.handleSelectValueLimitChange(t)}}" .selectedOption="${this._getValueLimitSelection()}"></select-down></div><div class="flex jc-sb ai-center" style="width:100%;margin-bottom:5px"><label>Threshold</label><input-checkbox .checked="${this.viewer.params.omicsBox.enableLimit}" @change="${t=>{this.handleDatasetSetting(t,"enableLimit")}}" style="background-color:none;display:none" label=""></input-checkbox><input-text @change="${t=>{this.handleDatasetSetting(t,"limitNumber")}}" value="${this.viewer.params.omicsBox.limitNumber}" .disabled="${!this.viewer.params.omicsBox.enableLimit}" type="number" min="1" step="1" style="width:70px"></input-text></div><div class="flex jc-sb ai-center" style="width:100%"><label>Show others:</label><input-checkbox @change="${t=>{this.handleDatasetSetting(t,"showOthers")}}" .checked="${this.viewer.params.omicsBox.showOthers}" .disabled="${!this.viewer.params.omicsBox.enableLimit}" style="background-color:none" label=""></input-checkbox></div>`:null,initCallback:()=>{this.viewer.params.omicsBox.limitOption==le.ENTRY.name&&this.viewer.params.setParam("limitNumber",Math.min(this.viewer.getDatasetDims().rows,this.viewer.params.omicsBox.limitNumber)),this._filterMethodOption=this._getLimitSelection(),this._valueLimitOption=this._getValueLimitSelection()},order:0,subBlock:re.ADJUSTMENTS.FIELDSETS.LIMIT_OPTIONS},[Kt]:{block:re.ADJUSTMENTS,element:()=>L`<div class="flex jc-sb ai-center" style="width:100%;margin-bottom:5px"><label>Enable binning</label><input-checkbox .disabled="${this.viewer.params.omicsBox.enableLimit}" .checked="${this.viewer.params.omicsBox.enableBinning}" @change="${t=>{this.handleBinningCheckboxChange(t)}}" style="background-color:none" label=""></input-checkbox></div><div class="flex jc-sb ai-center" style="width:100%;margin-bottom:5px"><label>Automatic Bin Size</label><input-checkbox .disabled="${this.viewer.params.omicsBox.enableLimit||!this.viewer.params.omicsBox.enableBinning}" .checked="${this.viewer.params.omicsBox.enableAutomaticBinNumber}" @change="${t=>{this.handleDatasetSetting(t,"enableAutomaticBinNumber")}}" style="background-color:none" label=""></input-checkbox></div><div class="flex jc-sb ai-center" style="width:100%"><label>Bin Size</label><input-text class="inputWidth" style="direction:rtl" .disabled="${this.viewer.params.omicsBox.enableLimit||this.viewer.params.omicsBox.enableAutomaticBinNumber||!this.viewer.params.omicsBox.enableBinning}" @change="${t=>{this.handleDatasetSetting(t,"binsNumber")}}" value="${this.viewer.params.omicsBox.binsNumber}" type="range" min="1" max="${Math.min(this.viewer.data.getData(0).source.length,50)}" step="1" title="This is a reference number, the final number of bins will be adjusted based on readability."></input-text></div>`,initCallback:()=>{},order:2}};this.modules.forEach((e=>this.registerSidebarElement(e,t[e])))}handleThemeChange(t){this.viewer.theme!=t.detail.theme&&(this.viewer.theme=t.detail.theme,this.viewer.chart.dispose(),this.viewer._createChart(!0))}handleSortingCheckboxChange(t){this.viewer.params.setParam("enableSorting",t.detail.checked),this.requestUpdate(),this.viewer._updateParams()}handleSelectSortingChange(t){this.viewer.params.omicsBox.sortingOption!=t.detail.name&&(this.viewer.params.setParam("sortingOption",t.detail.name),this.viewer._updateParams())}handleLabelCheckboxChange(t){this.viewer.params.setParam("enableLabels",t.detail.checked),this.viewer.updateSeriesCallbacks(),this.viewer._updateParams()}_enableZoomSliders(t){let e=this.viewer.grid.getGridOptions().grid[0];this.viewer.options.dataZoom.filter((t=>"slider"==t.type)).map((i=>{i.show=t,i.right&&(i.right=e.right)})),this.viewer.grid.addOffset("zoomSlider","bottom",40*(t?1:0)),this.viewer.grid.addOffset("zoomSlider","right",40*(t?1:0)),this.viewer._updateGridOptions(),this.viewer._updateOptions("dataZoom")}handleSymbolSizeChange(t){let e=parseInt(t.detail.value);this.viewer.options.series.map((t=>{t.symbol&&!1!==t._obEditable&&(t.symbolSize=e)})),this.viewer._updateOptions("series",!1,!0)}handleZoomCheckboxChange(t){this.viewer.params.setParam("enableZoomSlider",t.detail.checked),this._enableZoomSliders(t.detail.checked),this.requestUpdate()}handleDatasetSetting(t,e){this.viewer.params.setParam(e,"checked"in t.detail?t.detail.checked:t.detail.value),this.requestUpdate()}handleBinningCheckboxChange(t){this.handleDatasetSetting(t,"enableBinning"),t.detail.checked||this.viewer._restoreOriginalAxisTypes()}handleRelativeValuesCheckboxChange(t){this.viewer.params.setParam("relativeValues",t.detail.checked)}handlePlotType(t){let e=this.viewer.params.omicsBox.enableZoomSlider;this.viewer.options.series.forEach((i=>{i.type=t.detail.plotType,"line"==i.type&&(i.areaStyle={opacity:t.detail.fill?1:0}),"pie"==i.type?(this.viewer._getOrientation()==Dt?i.encode=Object.assign(i.encode,{value:i.encode.x,itemName:i.encode.y}):i.encode=Object.assign(i.encode,{value:i.encode.y,itemName:i.encode.x}),i._orgItemStyle=i.itemStyle,i.itemStyle={},this.viewer.options.xAxis[i.xAxisIndex].show=!1,this.viewer.options.yAxis[i.yAxisIndex].show=!1,e=!1,i.label=Object.assign({formatter:pe.PIE_CB,_pieOrgFormatter:i.label?i.label._orgFormatter:void 0},i.label||{}),i._obPieLabel=!0,this.viewer._restoreSeriesCallbacks(i,i._index)):(i._orgItemStyle&&(i.itemStyle=i._orgItemStyle),i._obPieLabel&&(delete i._obPieLabel,delete i.label.formatter,delete i.label._orgFormatter,i.label._pieOrgFormatter&&(i.label._orgFormatter=i.label._pieOrgFormatter),delete i.label._pieOrgFormatter,i.label.show=!1,this.viewer._restoreSeriesCallbacks(i,i._index)),this.viewer.options.xAxis[i.xAxisIndex].show=!0,this.viewer.options.yAxis[i.yAxisIndex].show=!0)}));this.viewer.setOrientation(t.detail.isHorizontal?Dt:$t,this.viewer.options)&&this.viewer.data.processData({updateLabels:!1}),this._enableZoomSliders(e),"category"==this.viewer.options.yAxis.type&&(this.viewer.options.yAxis.axisLabel=Object.assign(this.viewer.options.yAxis.axisLabel||{},{interval:0})),"category"==this.viewer.options.xAxis.type&&(this.viewer.options.xAxis.axisLabel=Object.assign(this.viewer.options.xAxis.axisLabel||{},{interval:0})),this.viewer._updateOptions(this.viewer.options),"pie"!=t.detail.plotType&&this.viewer._setLabelTruncatingOptions(!0),this.requestUpdate()}handleAxisInterval(t,e){this.viewer._updateOptions(t),"splitNumber"==e.detail.attribute&&this.viewer._setLabelTruncatingOptions(!0,[t])}_getValidPlotTypes(){let t=[];return this.modules.includes(Gt)&&t.push("bar","horizontal-bar"),!this.viewer.hasCategoryColors()&&this.modules.includes(Ht)&&t.push("line","area"),1==this.viewer.options.series.length&&this.modules.includes(Vt)&&t.push("pie"),this.viewer.hasBothValueOrgAxis()&&(t=t.filter((t=>"pie"!=t&&"horizontal-bar"!=t))),t}_getSelectionByName(t,e){return Object.values(t).find((t=>t.name==e))||Object.values(t)[0]}_hasValueLimitAvailable(){const t=this._getSelectionByName(le,this.viewer.params.omicsBox.limitOption);return[le.VALUE_HIGHER.name,le.VALUE_LOWER.name].includes(t.name)}_getLimitOptions(){return[qe.ABSOLUTE_VALUE,qe.ENTRY]}_getLimitSelection(){if(!this._filterMethodOption){switch(this._getSelectionByName(le,this.viewer.params.omicsBox.limitOption).name){case le.ENTRY.name:return qe.ENTRY;case le.VALUE_HIGHER.name:case le.VALUE_LOWER.name:return qe.ABSOLUTE_VALUE;default:return qe.ENTRY}}return this._filterMethodOption}_getValueLimitSelection(){if(!this._valueLimitOption){switch(this._getSelectionByName(le,this.viewer.params.omicsBox.limitOption).name){case le.VALUE_HIGHER.name:return Xe.HIGHER;case le.VALUE_LOWER.name:default:return Xe.LOWER}}return this._valueLimitOption}_getValueLimitOptions(){return[Xe.LOWER,Xe.HIGHER]}_getSortingOptions(){return 1==this.viewer.options.series.length?he:ce}handleSelectLimitChange(t){let e=t.detail.name;if(this._filterMethodOption=this._getSelectionByName(qe,t.detail.name),t.detail.name==qe.ABSOLUTE_VALUE.name){switch(this._getValueLimitSelection().name){case Xe.HIGHER.name:e=le.VALUE_HIGHER.name;break;case Xe.LOWER.name:e=le.VALUE_LOWER.name}console.log("ABSOLUTE VALUE SELECTION",t.detail.name,e)}this.viewer.params.omicsBox.limitOption!=e&&(this.viewer.params.setParam("limitOption",e),this.viewer._updateParams(),this.requestUpdate())}handleSelectValueLimitChange(t){let e=t.detail.name,i=this._getLimitSelection();if(this._valueLimitOption=this._getSelectionByName(Xe,t.detail.name),i.name==qe.ABSOLUTE_VALUE.name){switch(t.detail.name){case Xe.HIGHER.name:e=le.VALUE_HIGHER.name;break;case Xe.LOWER.name:e=le.VALUE_LOWER.name}console.log("LIMIT ABSOLUTE VALUE SELECTION",t.detail.name,e)}else console.log("OPTION NOT SUPPORTED",i);this.viewer.params.omicsBox.limitOption!=e&&(this.viewer.params.setParam("limitOption",e),this.viewer._updateParams(),this.requestUpdate())}handleFormattingChange(t,e,i,s=0){const o={text:"title"==e?"text":"name",style:i},n=["nameTextStyle","textStyle"].includes(i),a=n?this.getGridInfoFromOptions({options:t.detail.options,keys:Object.assign({component:e},o),chart:this.viewer.getChart()}):{},r=this.createSettingsChangeEvent(Object.assign({component:e,componentIndex:s,property:i,options:t.detail.options},n?{grid:a.grid}:{}));this.viewer.dispatchEvent(r)}}customElements.define("chart-viewer-sidebar",Ze);class Je{constructor(t){this.args=t,this.reqidMap={}}setup(){this.webSocket=new WebSocket(this.args.url,this.args.protocols),this.webSocket.onmessage=t=>{var e=JSON.parse(t.data.replace(/\bNaN\b/g,'"."')),i=this.reqidMap[e.reqid];null!=i?(delete this.reqidMap[e.reqid],i(e.data)):null!=this.args.serverCallback&&this.args.serverCallback(e)},this.webSocket.onopen=t=>{null!=this.args.onopen&&this.args.onopen(t)},this.webSocket.onclose=t=>{null!=this.args.onclose&&this.args.onclose(t)},this.webSocket.onerror=t=>{null!=this.args.onerror&&this.args.onerror(t)},this.webSocket.addEventListener("close",function(t){this.webSocket=null,setTimeout(function(){console.log("Reconnecting"),this.setup()}.bind(this),2e3)}.bind(this))}close(){this.webSocket.close()}sendJson(t,e){var i=this.genReqid(e);this.trySend({reqid:i,data:t})}async restRequest(t,e,i={},s=(()=>{})){const o=await fetch(`${this.args.url}/${t}`,{headers:{"Content-Type":"application/json"},method:e,body:"GET"!==e?JSON.stringify(i):void 0});s(await o.json())}trySend(t){}genReqid(t){for(var e=this.randomString(10)+(Date.now()+performance.now()).toString().replace(".","");null!=this.reqidMap[e];)e=Date.now().toString();return this.reqidMap[e]=t,e}randomString(t){var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";t=t||10;for(var i="",s=0;s<t;s++)i+=e.charAt(this.randomNumber(0,e.length-1));return i}randomNumber(t,e){return Math.floor(Math.random()*(e-t+1))+t}}window.parsePlainText=echarts.format.parsePlainText;class Ye extends(st(it)){constructor(t,e){super();var i=URI();i.segment(0),""==i.domain()?i.hostname():i.domain();this.webSocketRequest=new Je({url:"http://127.0.0.1:8080",serverCallback:t=>{console.log("Default WS callback.")}})}renderSidebarEl(){return L`<chart-viewer-sidebar></chart-viewer-sidebar>`}renderWebpartEl(){return L`<chart-viewer .wsRequest="${this.webSocketRequest}"><slot></slot></chart-viewer>`}firstUpdated(){this.webpartEl=this.shadowRoot.querySelector("chart-viewer"),this.sidebarEl=this.shadowRoot.querySelector("chart-viewer-sidebar"),this.setWebpartEl(this.webpartEl),this.setSidebarEl(this.sidebarEl);let t=()=>{this.sidebarEl.init({viewer:this.webpartEl,modules:this.webpartEl.params.getSidebarModules()}),this.webpartEl.removeEventListener("ready",t)};this.webpartEl.addEventListener("ready",t)}render(){return this.renderWebPart()}}customElements.define("chart-web-part",Ye);export{Ye as ChartWebPart};
